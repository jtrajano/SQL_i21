/*
Deployment script for i1410Dev

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "i1410Dev"
:setvar DefaultFilePrefix "i1410Dev"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL10_50.SQL2008R2DEV\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL10_50.SQL2008R2DEV\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
/*
 Pre-Deployment Script Template							
--------------------------------------------------------------------------------------
 This file contains SQL statements that will be executed before the build script.	
 Use SQLCMD syntax to include a file in the pre-deployment script.			
 Example:      :r .\myfile.sql								
 Use SQLCMD syntax to reference a variable in the pre-deployment script.		
 Example:      :setvar TableName MyTable							
               SELECT * FROM [$(TableName)]					
--------------------------------------------------------------------------------------
*/

IF OBJECT_ID('tempdb..##tblOriginMod') IS NOT NULL DROP TABLE ##tblOriginMod
GO

-- Validate if there are more than ONE record on coctlmst. if there are, raise error
IF (SELECT count(*) from coctlmst) >1
BEGIN
	GOTO MULTIPLE_Rec;	
END

IF (SELECT count(*) from coctlmst) = 0
BEGIN
	GOTO NO_Rec;	
END


CREATE TABLE ##tblOriginMod
(
	 intModId INT IDENTITY(1,1)
	, strDBName nvarchar(50) NOT NULL 
	, strPrefix NVARCHAR(5) NOT NULL 
	, strName NVARCHAR(30) NOT NULL 
	, ysnUsed BIT NOT NULL 
)


-- AG ACCOUNTING
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_ag')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''AG'', N''AG ACCOUNTING'', CASE ISNULL(coctl_ag, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END

-- AG SPECIAL PRICES
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_sp_yn')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''ASP'', N''AG Special Price'', CASE ISNULL(coctl_sp_yn, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END


-- PETRO ACCOUNTING
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_pt')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''PT'', N''PETRO ACCOUNTING'', CASE ISNULL(coctl_pt, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END

-- PT SPECIAL PRICES
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_ps_yn')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''PSP'', N''PT Special Price'', CASE ISNULL(coctl_ps_yn, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END


-- ACCOUNTS PAYABLE
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_ap')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''AP'', N''ACCOUNTS PAYABLE'', CASE ISNULL(coctl_ap, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END

-- CONTRACTS
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_cn_yn')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''CN'', N''CONTRACTS'', CASE ISNULL(coctl_pt, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END

-- GRAINS
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_ga')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''GR'', N''GRAINS'', CASE ISNULL(coctl_ga, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END

-- TAX FORMS
IF EXISTS (SELECT TOP 1 1 from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME = 'coctl_px_yn')
BEGIN
	EXEC ('INSERT INTO ##tblOriginMod (strDBName, strPrefix, strName, ysnUsed) SELECT TOP 1 db_name(), N''TX'', N''TAX FORMS'', CASE ISNULL(coctl_px_yn, ''N'') WHEN ''Y'' THEN 1 else 0 END FROM coctlmst')
END





RETURN;
MULTIPLE_Rec:
	RAISERROR(N'There are multiple records on coctlmst. Deployment terminated.', 16,1)
	RETURN;
	
NO_Rec:
	RAISERROR(N'There are no records on coctlmst. Deployment terminated.', 16,1)

GO

-- CASH MANAGEMENT
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'apcbkmst')
	DROP VIEW apcbkmst

IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AP') = 1
	EXEC ('
		CREATE VIEW [dbo].apcbkmst
		AS 

		SELECT * FROM apcbkmst_origin
	')
	IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'apchkmst')
		DROP VIEW apchkmst

	IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AP') = 1
	BEGIN
		EXEC ('
			CREATE VIEW [dbo].apchkmst
			AS 
				SELECT * FROM apchkmst_origin
			')

		EXEC('
				CREATE TRIGGER trg_delete_apchkmst
				ON [dbo].apchkmst
				INSTEAD OF DELETE
				AS
				BEGIN 

				SET NOCOUNT ON

					-- Declare the transaction types (constant)
					DECLARE @BANK_DEPOSIT AS INT = 1
							,@BANK_WITHDRAWAL AS INT = 2
							,@MISCELLANEOUS_CHECKS AS INT = 3
							,@BANK_TRANSFER AS INT = 4
							,@BANK_TRANSACTION AS INT = 5
							,@CREDIT_CARD_CHARGE AS INT = 6
							,@CREDIT_CARD_RETURNS AS INT = 7
							,@CREDIT_CARD_PAYMENTS AS INT = 8
							,@BANK_TRANSFER_WD AS INT = 9
							,@BANK_TRANSFER_DEP AS INT = 10
							,@ORIGIN_DEPOSIT AS INT = 11		-- NEGATIVE AMOUNT, INDICATOR: O, APCHK_CHK_NO PREFIX: NONE
							,@ORIGIN_CHECKS AS INT = 12			-- POSITIVE AMOUNT, INDICATOR: C, APCHK_CHK_NO PREFIX: N/A, IT MUST BE A VALId NUMBER
							,@ORIGIN_EFT AS INT = 13			-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: ''E''		
							,@ORIGIN_WITHDRAWAL AS INT = 14		-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: NONE
							,@ORIGIN_WIRE AS INT = 15			-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: ''W''
			
							-- Declare the local variables. 
							,@intBankAccountId AS INT
	
					-- Delete record from the apchkmst base table (apchkmst_origin) in the origin system. 
					DELETE	dbo.apchkmst_origin 
					FROM	dbo.apchkmst_origin f INNER JOIN deleted d
								ON f.apchk_chk_no = d.apchk_chk_no
					IF @@ERROR <> 0 GOTO EXIT_TRIGGER				
				
					-- Delete record from Cash Management > Bank Transaction table
					DELETE	dbo.tblCMBankTransaction
					FROM	dbo.tblCMBankTransaction f INNER JOIN deleted d
									ON f.strLink = ( CAST(d.apchk_cbk_no AS NVARCHAR(2)) 
													+ CAST(d.apchk_rev_dt AS NVARCHAR(10)) 
													+ CAST(d.apchk_trx_ind AS NVARCHAR(1)) 
													+ CAST(d.apchk_chk_no AS NVARCHAR(8))
									) COLLATE Latin1_General_CI_AS 
									AND f.intBankTransactionTypeId IN (@ORIGIN_DEPOSIT, @ORIGIN_CHECKS, @ORIGIN_EFT, @ORIGIN_WITHDRAWAL, @ORIGIN_WIRE)
							INNER JOIN dbo.tblCMBankAccount e
								ON e.strCbkNo = d.apchk_cbk_no COLLATE Latin1_General_CI_AS
								AND e.intBankAccountId = f.intBankAccountId						
					IF @@ERROR <> 0 GOTO EXIT_TRIGGER

				EXIT_TRIGGER:

				END
			')

		EXEC ('
			CREATE TRIGGER trg_insert_apchkmst
			ON [dbo].apchkmst
			INSTEAD OF INSERT
			AS
			BEGIN 

			SET NOCOUNT ON 

				-- Insert record to the origin-base table. 
				INSERT dbo.apchkmst_origin(
						apchk_cbk_no
						,apchk_rev_dt
						,apchk_trx_ind
						,apchk_chk_no
						,apchk_alt_cbk_no
						,apchk_alt_trx_ind
						,apchk_alt_chk_no
						,apchk_vnd_no
						,apchk_alt2_cbk_no
						,apchk_name
						,apchk_addr_1
						,apchk_addr_2
						,apchk_city
						,apchk_st
						,apchk_zip
						,apchk_chk_amt
						,apchk_disc_amt
						,apchk_wthhld_amt
						,apchk_1099_amt
						,apchk_gl_rev_dt
						,apchk_adv_chk_yn
						,apchk_man_auto_ind
						,apchk_void_ind
						,apchk_void_rev_dt
						,apchk_cleared_ind
						,apchk_clear_rev_dt
						,apchk_src_sys
						,apchk_comment_1
						,apchk_comment_2
						,apchk_comment_3
						,apchk_currency_rt
						,apchk_currency_cnt
						,apchk_payee_1
						,apchk_payee_2
						,apchk_payee_3
						,apchk_payee_4
						,apchk_user_id
						,apchk_user_rev_dt
				)
				SELECT
						apchk_cbk_no		= i.apchk_cbk_no		
						,apchk_rev_dt		= i.apchk_rev_dt		
						,apchk_trx_ind		= i.apchk_trx_ind		
						,apchk_chk_no		= i.apchk_chk_no		
						,apchk_alt_cbk_no	= i.apchk_alt_cbk_no	
						,apchk_alt_trx_ind	= i.apchk_alt_trx_ind	
						,apchk_alt_chk_no	= i.apchk_alt_chk_no	
						,apchk_vnd_no		= i.apchk_vnd_no		
						,apchk_alt2_cbk_no	= i.apchk_alt2_cbk_no	
						,apchk_name			= i.apchk_name			
						,apchk_addr_1		= i.apchk_addr_1		
						,apchk_addr_2		= i.apchk_addr_2		
						,apchk_city			= i.apchk_city			
						,apchk_st			= i.apchk_st			
						,apchk_zip			= i.apchk_zip			
						,apchk_chk_amt		= i.apchk_chk_amt		
						,apchk_disc_amt		= i.apchk_disc_amt		
						,apchk_wthhld_amt	= i.apchk_wthhld_amt	
						,apchk_1099_amt		= i.apchk_1099_amt		
						,apchk_gl_rev_dt	= i.apchk_gl_rev_dt	
						,apchk_adv_chk_yn	= i.apchk_adv_chk_yn	
						,apchk_man_auto_ind	= i.apchk_man_auto_ind	
						,apchk_void_ind		= i.apchk_void_ind		
						,apchk_void_rev_dt	= i.apchk_void_rev_dt	
						,apchk_cleared_ind	= i.apchk_cleared_ind	
						,apchk_clear_rev_dt	= i.apchk_clear_rev_dt	
						,apchk_src_sys		= i.apchk_src_sys		
						,apchk_comment_1	= i.apchk_comment_1	
						,apchk_comment_2	= i.apchk_comment_2	
						,apchk_comment_3	= i.apchk_comment_3	
						,apchk_currency_rt	= i.apchk_currency_rt	
						,apchk_currency_cnt	= i.apchk_currency_cnt	
						,apchk_payee_1		= i.apchk_payee_1		
						,apchk_payee_2		= i.apchk_payee_2		
						,apchk_payee_3		= i.apchk_payee_3		
						,apchk_payee_4		= i.apchk_payee_4		
						,apchk_user_id		= i.apchk_user_id		
						,apchk_user_rev_dt	= i.apchk_user_rev_dt	
				FROM inserted i
				IF @@ERROR <> 0 GOTO EXIT_TRIGGER

				-- Declare the transaction types (constant)
				DECLARE @BANK_DEPOSIT AS INT = 1
						,@BANK_WITHDRAWAL AS INT = 2
						,@MISCELLANEOUS_CHECKS AS INT = 3
						,@BANK_TRANSFER AS INT = 4
						,@BANK_TRANSACTION AS INT = 5
						,@CREDIT_CARD_CHARGE AS INT = 6
						,@CREDIT_CARD_RETURNS AS INT = 7
						,@CREDIT_CARD_PAYMENTS AS INT = 8
						,@BANK_TRANSFER_WD AS INT = 9
						,@BANK_TRANSFER_DEP AS INT = 10
						,@ORIGIN_DEPOSIT AS INT = 11		-- NEGATIVE AMOUNT, INDICATOR: O, APCHK_CHK_NO PREFIX: NONE
						,@ORIGIN_CHECKS AS INT = 12			-- POSITIVE AMOUNT, INDICATOR: C, APCHK_CHK_NO PREFIX: N/A, IT MUST BE A VALId NUMBER
						,@ORIGIN_EFT AS INT = 13			-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: ''E''		
						,@ORIGIN_WITHDRAWAL AS INT = 14		-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: NONE
						,@ORIGIN_WIRE AS INT = 15			-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: ''W''
			
						-- Declare the local variables. 
						,@intBankAccountId AS INT

				-- Insert the record from the origin system to i21. 
				INSERT INTO tblCMBankTransaction (
						strTransactionId
						,intBankTransactionTypeId
						,intBankAccountId
						,intCurrencyId
						,dblExchangeRate
						,dtmDate
						,strPayee
						,intPayeeId
						,strAddress
						,strZipCode
						,strCity
						,strState
						,strCountry
						,dblAmount
						,strAmountInWords
						,strMemo
						,strReferenceNo
						,dtmCheckPrinted
						,ysnCheckToBePrinted
						,ysnCheckVoid
						,ysnPosted
						,strLink
						,ysnClr
						,dtmDateReconciled
						,intCreatedUserId
						,dtmCreated
						,intLastModifiedUserId
						,dtmLastModified
						,intConcurrencyId	
				)
				SELECT 
						strTransactionId			=	CAST(i.apchk_cbk_no AS NVARCHAR(2)) + ''-''
														+ CAST(i.apchk_rev_dt AS NVARCHAR(10)) + ''-''
														+ CAST(i.apchk_trx_ind AS NVARCHAR(1)) + ''-''
														+ CAST(i.apchk_chk_no AS NVARCHAR(8))
						,intBankTransactionTypeId	=	
														CASE
															WHEN i.apchk_chk_amt > 0 THEN 
																CASE 
																	WHEN LEFT(i.apchk_chk_no, 1) = ''E'' THEN @ORIGIN_EFT
																	WHEN LEFT(i.apchk_chk_no, 1) = ''W'' THEN @ORIGIN_WIRE
																	WHEN i.apchk_trx_ind = ''C'' THEN @ORIGIN_CHECKS
																	ELSE @ORIGIN_WITHDRAWAL
																END
															WHEN i.apchk_chk_amt < 0 THEN @ORIGIN_DEPOSIT
														END
						,intBankAccountId			=	f.intBankAccountId
						,intCurrencyId				=	dbo.fn_GetCurrencyIdFromOriginToi21(i.apchk_currency_cnt)
						,dblExchangeRate			=	ISNULL(i.apchk_currency_rt, 1)
						,dtmDate					=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_gl_rev_dt)
						,strPayee					=	RTRIM(LTRIM(ISNULL(i.apchk_name, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_1))) > 0 THEN '', ''  ELSE '''' END +
														RTRIM(LTRIM(ISNULL(i.apchk_payee_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_2))) > 0 THEN '', ''  ELSE '''' END +
														RTRIM(LTRIM(ISNULL(i.apchk_payee_2, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_3))) > 0 THEN '', ''  ELSE '''' END +
														RTRIM(LTRIM(ISNULL(i.apchk_payee_3, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_4))) > 0 THEN '', ''  ELSE '''' END +
														RTRIM(LTRIM(ISNULL(i.apchk_payee_4, '''')))							
						,intPayeeId					=	NULL
						,strAddress					=	RTRIM(LTRIM(ISNULL(i.apchk_addr_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_addr_2))) > 0 THEN CHAR(13) ELSE '''' END +
														RTRIM(LTRIM(ISNULL(i.apchk_addr_2, '''')))
						,strZipCode					=	RTRIM(LTRIM(i.apchk_zip))
						,strCity					=	RTRIM(LTRIM(i.apchk_city))
						,strState					=	RTRIM(LTRIM(i.apchk_st))
						,strCountry					=	NULL
						,dblAmount					=	ABS(i.apchk_chk_amt) -- Import as a positive AMOUNT value. 
						,strAmountInWords			=	dbo.fn_ConvertNumberToWord(ABS(i.apchk_chk_amt))
						,strMemo					=	RTRIM(LTRIM(ISNULL(i.apchk_comment_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_comment_2))) > 0 THEN CHAR(13) ELSE '''' END +
														RTRIM(LTRIM(ISNULL(i.apchk_comment_2, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_comment_3))) > 0 THEN CHAR(13) ELSE '''' END +
														RTRIM(LTRIM(ISNULL(i.apchk_comment_3, ''''))) 
						,strReferenceNo				=	RTRIM(LTRIM(i.apchk_chk_no))
						,dtmCheckPrinted			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_gl_rev_dt)
						,ysnCheckToBePrinted		=	1
						,ysnCheckVoid				=	CASE
															WHEN i.apchk_void_ind = ''Y'' THEN 1
															ELSE 0
														END
						,ysnPosted					=	1
						,strLink					=	CAST(apchk_cbk_no AS NVARCHAR(2)) 
														+ CAST(apchk_rev_dt AS NVARCHAR(10)) 
														+ CAST(apchk_trx_ind AS NVARCHAR(1)) 
														+ CAST(apchk_chk_no AS NVARCHAR(8)) 
						,ysnClr						=	CASE 
															WHEN i.apchk_cleared_ind = ''C'' THEN 1
															ELSE 0
														END
						,dtmDateReconciled			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_clear_rev_dt)
						,intCreatedUserId			=	i.apchk_user_id
						,dtmCreated					=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_user_rev_dt)
						,intLastModifiedUserId		=	i.apchk_user_id
						,dtmLastModified			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_rev_dt)
						,intConcurrencyId			=	1
				FROM	dbo.tblCMBankAccount f INNER JOIN inserted i
							ON f.strCbkNo = i.apchk_cbk_no COLLATE Latin1_General_CI_AS  	
				WHERE	f.intBankAccountId IS NOT NULL
						AND i.apchk_chk_amt <> 0
						AND dbo.fn_ConvertOriginDateToSQLDateTime(apchk_gl_rev_dt) IS NOT NULL
				IF @@ERROR <> 0 GOTO EXIT_TRIGGER	 
	
			EXIT_TRIGGER: 

			END
			')

	EXEC ('
			CREATE TRIGGER trg_update_apchkmst
			ON [dbo].apchkmst
			INSTEAD OF UPDATE
			AS
			BEGIN 

			SET NOCOUNT ON

				-- Declare the transaction types (constant)
				DECLARE @BANK_DEPOSIT AS INT = 1
						,@BANK_WITHDRAWAL AS INT = 2
						,@MISCELLANEOUS_CHECKS AS INT = 3
						,@BANK_TRANSFER AS INT = 4
						,@BANK_TRANSACTION AS INT = 5
						,@CREDIT_CARD_CHARGE AS INT = 6
						,@CREDIT_CARD_RETURNS AS INT = 7
						,@CREDIT_CARD_PAYMENTS AS INT = 8
						,@BANK_TRANSFER_WD AS INT = 9
						,@BANK_TRANSFER_DEP AS INT = 10
						,@ORIGIN_DEPOSIT AS INT = 11		-- NEGATIVE AMOUNT, INDICATOR: O, APCHK_CHK_NO PREFIX: NONE
						,@ORIGIN_CHECKS AS INT = 12			-- POSITIVE AMOUNT, INDICATOR: C, APCHK_CHK_NO PREFIX: N/A, IT MUST BE A VALId NUMBER
						,@ORIGIN_EFT AS INT = 13			-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: ''E''		
						,@ORIGIN_WITHDRAWAL AS INT = 14		-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: NONE
						,@ORIGIN_WIRE AS INT = 15			-- POSITIVE AMOUNT, INDICATOR: N/A, APCHK_CHK_NO PREFIX: ''W''
						
						-- Declare the local variables. 
						,@intBankAccountId AS INT
						
				-- Update the base table first (apchkmst_origin)
				UPDATE dbo.apchkmst_origin
				SET		apchk_cbk_no		= i.apchk_cbk_no		
						,apchk_rev_dt		= i.apchk_rev_dt		
						,apchk_trx_ind		= i.apchk_trx_ind		
						,apchk_chk_no		= i.apchk_chk_no		
						,apchk_alt_cbk_no	= i.apchk_alt_cbk_no	
						,apchk_alt_trx_ind	= i.apchk_alt_trx_ind	
						,apchk_alt_chk_no	= i.apchk_alt_chk_no	
						,apchk_vnd_no		= i.apchk_vnd_no		
						,apchk_alt2_cbk_no	= i.apchk_alt2_cbk_no	
						,apchk_name			= i.apchk_name			
						,apchk_addr_1		= i.apchk_addr_1		
						,apchk_addr_2		= i.apchk_addr_2		
						,apchk_city			= i.apchk_city			
						,apchk_st			= i.apchk_st			
						,apchk_zip			= i.apchk_zip			
						,apchk_chk_amt		= i.apchk_chk_amt		
						,apchk_disc_amt		= i.apchk_disc_amt		
						,apchk_wthhld_amt	= i.apchk_wthhld_amt	
						,apchk_1099_amt		= i.apchk_1099_amt		
						,apchk_gl_rev_dt	= i.apchk_gl_rev_dt	
						,apchk_adv_chk_yn	= i.apchk_adv_chk_yn	
						,apchk_man_auto_ind	= i.apchk_man_auto_ind	
						,apchk_void_ind		= i.apchk_void_ind		
						,apchk_void_rev_dt	= i.apchk_void_rev_dt	
						,apchk_cleared_ind	= i.apchk_cleared_ind	
						,apchk_clear_rev_dt	= i.apchk_clear_rev_dt	
						,apchk_src_sys		= i.apchk_src_sys		
						,apchk_comment_1	= i.apchk_comment_1	
						,apchk_comment_2	= i.apchk_comment_2	
						,apchk_comment_3	= i.apchk_comment_3	
						,apchk_currency_rt	= i.apchk_currency_rt	
						,apchk_currency_cnt	= i.apchk_currency_cnt	
						,apchk_payee_1		= i.apchk_payee_1		
						,apchk_payee_2		= i.apchk_payee_2		
						,apchk_payee_3		= i.apchk_payee_3		
						,apchk_payee_4		= i.apchk_payee_4		
						,apchk_user_id		= i.apchk_user_id		
						,apchk_user_rev_dt	= i.apchk_user_rev_dt
				FROM	dbo.apchkmst_origin f INNER JOIN inserted i
							ON f.apchk_cbk_no = i.apchk_cbk_no
							AND f.apchk_rev_dt = i.apchk_rev_dt
							AND f.apchk_trx_ind = i.apchk_trx_ind
							AND f.apchk_chk_no = i.apchk_chk_no
				IF @@ERROR <> 0 GOTO EXIT_TRIGGER
						
				-- Check if the record exists. 
				-- If it does not exists, insert it.
				IF NOT EXISTS (
					SELECT	TOP 1 1 
					FROM	dbo.tblCMBankTransaction f INNER JOIN inserted i
								ON f.strLink = ( CAST(i.apchk_cbk_no AS NVARCHAR(2)) 
												+ CAST(i.apchk_rev_dt AS NVARCHAR(10))
												+ CAST(i.apchk_trx_ind AS NVARCHAR(1))
												+ CAST(i.apchk_chk_no AS NVARCHAR(8))
								) COLLATE Latin1_General_CI_AS 
								AND f.intBankTransactionTypeId IN (@ORIGIN_DEPOSIT, @ORIGIN_CHECKS, @ORIGIN_EFT, @ORIGIN_WITHDRAWAL, @ORIGIN_WIRE)
				)
				BEGIN 
					-- Insert the record from the origin system to i21. 
					INSERT INTO tblCMBankTransaction (
							strTransactionId
							,intBankTransactionTypeId
							,intBankAccountId
							,intCurrencyId
							,dblExchangeRate
							,dtmDate
							,strPayee
							,intPayeeId
							,strAddress
							,strZipCode
							,strCity
							,strState
							,strCountry
							,dblAmount
							,strAmountInWords
							,strMemo
							,strReferenceNo
							,dtmCheckPrinted
							,ysnCheckToBePrinted
							,ysnCheckVoid
							,ysnPosted
							,strLink
							,ysnClr
							,dtmDateReconciled
							,intCreatedUserId
							,dtmCreated
							,intLastModifiedUserId
							,dtmLastModified
							,intConcurrencyId	
					)
					SELECT 
							strTransactionId			=	CAST(i.apchk_cbk_no AS NVARCHAR(2)) + ''-''
															+ CAST(i.apchk_rev_dt AS NVARCHAR(10)) + ''-''
															+ CAST(i.apchk_trx_ind AS NVARCHAR(1)) + ''-''
															+ CAST(i.apchk_chk_no AS NVARCHAR(8))
							,intBankTransactionTypeId	=	
															CASE
																WHEN i.apchk_chk_amt > 0 THEN 
																	CASE 
																		WHEN LEFT(i.apchk_chk_no, 1) = ''E'' THEN @ORIGIN_EFT
																		WHEN LEFT(i.apchk_chk_no, 1) = ''W'' THEN @ORIGIN_WIRE
																		WHEN i.apchk_trx_ind = ''C'' THEN @ORIGIN_CHECKS
																		ELSE @ORIGIN_WITHDRAWAL
																	END
																WHEN i.apchk_chk_amt < 0 THEN @ORIGIN_DEPOSIT
															END
							,intBankAccountId			=	f.intBankAccountId
							,intCurrencyId				=	dbo.fn_GetCurrencyIdFromOriginToi21(i.apchk_currency_cnt)
							,dblExchangeRate			=	ISNULL(i.apchk_currency_rt, 1)
							,dtmDate					=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_gl_rev_dt)
							,strPayee					=	RTRIM(LTRIM(ISNULL(i.apchk_name, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_1))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_2))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_2, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_3))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_3, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_4))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_4, '''')))							
							,intPayeeId					=	NULL
							,strAddress					=	RTRIM(LTRIM(ISNULL(i.apchk_addr_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_addr_2))) > 0 THEN CHAR(13) ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_addr_2, '''')))
							,strZipCode					=	RTRIM(LTRIM(i.apchk_zip))
							,strCity					=	RTRIM(LTRIM(i.apchk_city))
							,strState					=	RTRIM(LTRIM(i.apchk_st))
							,strCountry					=	NULL
							,dblAmount					=	ABS(i.apchk_chk_amt) -- Import as a positive AMOUNT value. 
							,strAmountInWords			=	dbo.fn_ConvertNumberToWord(ABS(i.apchk_chk_amt))
							,strMemo					=	RTRIM(LTRIM(ISNULL(i.apchk_comment_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_comment_2))) > 0 THEN CHAR(13) ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_comment_2, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_comment_3))) > 0 THEN CHAR(13) ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_comment_3, ''''))) 
							,strReferenceNo				=	RTRIM(LTRIM(i.apchk_chk_no))
							,dtmCheckPrinted			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_gl_rev_dt) 
							,ysnCheckToBePrinted		=	1
							,ysnCheckVoid				=	CASE
																WHEN i.apchk_void_ind = ''Y'' THEN 1
																ELSE 0
															END
							,ysnPosted					=	1
							,strLink					=	CAST(apchk_cbk_no AS NVARCHAR(2)) 
															+ CAST(apchk_rev_dt AS NVARCHAR(10)) 
															+ CAST(apchk_trx_ind AS NVARCHAR(1)) 
															+ CAST(apchk_chk_no AS NVARCHAR(8)) 
							,ysnClr						=	CASE 
																WHEN i.apchk_cleared_ind = ''C'' THEN 1
																ELSE 0
															END
							,dtmDateReconciled			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_clear_rev_dt)
							,intCreatedUserId			=	i.apchk_user_id
							,dtmCreated					=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_user_rev_dt)
							,intLastModifiedUserId		=	i.apchk_user_id
							,dtmLastModified			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_rev_dt)
							,intConcurrencyId			=	1
					FROM	dbo.tblCMBankAccount f INNER JOIN inserted i
								ON f.strCbkNo = i.apchk_cbk_no COLLATE Latin1_General_CI_AS  	
					WHERE	f.intBankAccountId IS NOT NULL
							AND i.apchk_chk_amt <> 0
							AND dbo.fn_ConvertOriginDateToSQLDateTime(apchk_gl_rev_dt) IS NOT NULL				
					IF @@ERROR <> 0 GOTO EXIT_TRIGGER	
				END		
				ELSE 
				BEGIN 
					-- Update the i21 bank transaction table. 
					-- However, do not allow the update if the bank record is already cleared. 
					UPDATE	dbo.tblCMBankTransaction 
					SET		
							strTransactionId			=	CAST(i.apchk_cbk_no AS NVARCHAR(2)) + ''-''
															+ CAST(i.apchk_rev_dt AS NVARCHAR(10)) + ''-''
															+ CAST(i.apchk_trx_ind AS NVARCHAR(1)) + ''-''
															+ CAST(i.apchk_chk_no AS NVARCHAR(8))
							,intBankTransactionTypeId	=	
															CASE
																WHEN i.apchk_chk_amt > 0 THEN 
																	CASE 
																		WHEN LEFT(i.apchk_chk_no, 1) = ''E'' THEN @ORIGIN_EFT
																		WHEN LEFT(i.apchk_chk_no, 1) = ''W'' THEN @ORIGIN_WIRE
																		WHEN i.apchk_trx_ind = ''C'' THEN @ORIGIN_CHECKS
																		ELSE @ORIGIN_WITHDRAWAL
																	END
																WHEN i.apchk_chk_amt < 0 THEN @ORIGIN_DEPOSIT
															END
							,intBankAccountId			=	e.intBankAccountId
							,intCurrencyId				=	dbo.fn_GetCurrencyIdFromOriginToi21(i.apchk_currency_cnt)
							,dblExchangeRate			=	ISNULL(i.apchk_currency_rt, 1)
							,dtmDate					=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_gl_rev_dt)
							,strPayee					=	RTRIM(LTRIM(ISNULL(i.apchk_name, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_1))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_2))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_2, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_3))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_3, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_payee_4))) > 0 THEN '', ''  ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_payee_4, '''')))
							,intPayeeId					=	NULL
							,strAddress					=	RTRIM(LTRIM(ISNULL(i.apchk_addr_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_addr_2))) > 0 THEN CHAR(13) ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_addr_2, '''')))	
							,strZipCode					=	RTRIM(LTRIM(i.apchk_zip))
							,strCity					=	RTRIM(LTRIM(i.apchk_city))
							,strState					=	RTRIM(LTRIM(i.apchk_st))
							,strCountry					=	NULL
							,dblAmount					=	ABS(i.apchk_chk_amt) -- Import as a positive AMOUNT value. 
							,strAmountInWords			=	dbo.fn_ConvertNumberToWord(ABS(i.apchk_chk_amt))
							,strMemo					=	RTRIM(LTRIM(ISNULL(i.apchk_comment_1, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_comment_2))) > 0 THEN CHAR(13) ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_comment_2, ''''))) + CASE WHEN LEN(LTRIM(RTRIM(i.apchk_comment_3))) > 0 THEN CHAR(13) ELSE '''' END +
															RTRIM(LTRIM(ISNULL(i.apchk_comment_3, ''''))) 
							,strReferenceNo				=	RTRIM(LTRIM(i.apchk_chk_no))
							,dtmCheckPrinted			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_gl_rev_dt)
							,ysnCheckToBePrinted		=	1
							,ysnCheckVoid				=	CASE
																WHEN i.apchk_void_ind = ''Y'' THEN 1
																ELSE 0
															END
							,ysnPosted					=	1
							,strLink					=	CAST(apchk_cbk_no AS NVARCHAR(2)) 
															+ CAST(apchk_rev_dt AS NVARCHAR(10)) 
															+ CAST(apchk_trx_ind AS NVARCHAR(1)) 
															+ CAST(apchk_chk_no AS NVARCHAR(8)) 
							,ysnClr						=	CASE 
																WHEN i.apchk_cleared_ind = ''C'' THEN 1
																ELSE 0
															END
							,dtmDateReconciled			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_clear_rev_dt)
							,intCreatedUserId			=	i.apchk_user_id
							,dtmCreated					=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_user_rev_dt)
							,intLastModifiedUserId		=	i.apchk_user_id
							,dtmLastModified			=	dbo.fn_ConvertOriginDateToSQLDateTime(i.apchk_rev_dt)
							,intConcurrencyId			=	f.intConcurrencyId + 1
					FROM	inserted i INNER JOIN dbo.tblCMBankTransaction f
								ON f.strLink = ( CAST(i.apchk_cbk_no AS NVARCHAR(2)) 
												+ CAST(i.apchk_rev_dt AS NVARCHAR(10)) 
												+ CAST(i.apchk_trx_ind AS NVARCHAR(1)) 
												+ CAST(i.apchk_chk_no AS NVARCHAR(8))
								) COLLATE Latin1_General_CI_AS 
								AND f.intBankTransactionTypeId IN (@ORIGIN_DEPOSIT, @ORIGIN_CHECKS, @ORIGIN_EFT, @ORIGIN_WITHDRAWAL, @ORIGIN_WIRE)
								AND f.ysnClr = 0
							INNER JOIN dbo.tblCMBankAccount e
								ON e.strCbkNo = i.apchk_cbk_no COLLATE Latin1_General_CI_AS
								AND e.intBankAccountId = f.intBankAccountId				
					WHERE	e.intBankAccountId IS NOT NULL
							AND i.apchk_chk_amt <> 0
							AND dbo.fn_ConvertOriginDateToSQLDateTime(apchk_gl_rev_dt) IS NOT NULL
					IF @@ERROR <> 0 GOTO EXIT_TRIGGER
				END
				
			EXIT_TRIGGER:

			END
		')
	END
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwapivcmst')
	DROP VIEW vwapivcmst

IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AP') = 1
EXEC ('
	CREATE VIEW [dbo].[vwapivcmst]  
	AS  
	SELECT  
	 vwivc_vnd_no = apivc_vnd_no  
	, vwivc_ivc_no = apivc_ivc_no  
	, vwivc_status_ind = apivc_status_ind  
	, vwivc_cbk_no = apivc_cbk_no  
	, vwivc_chk_no = apivc_chk_no  
	, vwivc_trans_type = apivc_trans_type  
	, vwivc_pay_ind = apivc_pay_ind  
	, vwivc_ap_audit_no = apivc_ap_audit_no  
	, vwivc_pur_ord_no = apivc_pur_ord_no  
	, vwivc_po_rcpt_seq = apivc_po_rcpt_seq  
	, vwivc_ivc_rev_dt = apivc_ivc_rev_dt  
	, vwivc_disc_rev_dt = apivc_disc_rev_dt  
	, vwivc_due_rev_dt = apivc_due_rev_dt  
	, vwivc_chk_rev_dt = apivc_chk_rev_dt  
	, vwivc_gl_rev_dt = apivc_gl_rev_dt  
	, vwivc_orig_amt = apivc_orig_amt  
	, vwivc_disc_avail = apivc_disc_avail  
	, vwivc_disc_taken = apivc_disc_taken  
	, vwivc_wthhld_amt = apivc_wthhld_amt  
	, vwivc_net_amt = apivc_net_amt  
	, vwivc_1099_amt = apivc_1099_amt  
	, vwivc_comment = apivc_comment  
	, vwivc_adv_chk_no = apivc_adv_chk_no  
	, vwivc_recur_yn = apivc_recur_yn  
	, vwivc_currency = apivc_currency  
	, vwivc_currency_rt = apivc_currency_rt  
	, vwivc_currency_cnt = apivc_currency_cnt  
	, vwivc_user_id = apivc_user_id  
	, vwivc_user_rev_dt = apivc_user_rev_dt  
	, A4GLIdentity = CAST(A4GLIdentity   AS INT)
	FROM apivcmst
')

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwclsmst')
	DROP VIEW vwclsmst

GO
--AG view
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG') = 1
	EXEC ('
		CREATE VIEW [dbo].[vwclsmst]
		AS
			SELECT
			vwcls_desc				=CAST(agcls_desc AS CHAR(20))		 		
			,vwcls_sls_acct_no		=agcls_sls_acct_no	
			,vwcls_pur_acct_no		=agcls_pur_acct_no	
			,vwcls_var_acct_no		=agcls_var_acct_no	
			,vwcls_inv_acct_no		=agcls_inv_acct_no	
			,vwcls_beg_inv_acct_no	=agcls_beg_inv_acct_no	
			,vwcls_end_inv_acct_no	=agcls_end_inv_acct_no	
			,vwcls_cd =agcls_cd
			,A4GLIdentity	= CAST(A4GLIdentity   AS INT)
			FROM agclsmst
		')
GO

--PT view
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT') = 1
	EXEC ('
		CREATE VIEW [dbo].[vwclsmst]
			AS
			SELECT
			vwcls_desc				=CAST(ptcls_desc AS CHAR(20))		 		
			,vwcls_sls_acct_no		=ptcls_sls_acct_no	
			,vwcls_pur_acct_no		=ptcls_pur_acct_no	
			,vwcls_var_acct_no		=ptcls_var_acct_no	
			,vwcls_inv_acct_no		=ptcls_inv_acct_no	
			,vwcls_beg_inv_acct_no	=ptcls_beg_inv_acct_no	
			,vwcls_end_inv_acct_no	=ptcls_end_inv_acct_no	
			,vwcls_cd				=ptcls_class
			,A4GLIdentity			=CAST(A4GLIdentity   AS INT)
			FROM ptclsmst
	')
	
	
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCMBankAccount')
	DROP VIEW vwCMBankAccount

IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AP') = 1
	EXEC ('
		CREATE VIEW [dbo].vwCMBankAccount
		WITH SCHEMABINDING
		AS 

		SELECT	i21.intBankAccountId
				,i21.intBankId
				,i21.ysnActive
				,i21.intGLAccountId
				,i21.intCurrencyId
				,i21.intBankAccountType
				,i21.strContact
				,i21.strBankAccountNo
				,i21.strRTN
				,i21.strAddress
				,i21.strZipCode
				,i21.strCity
				,i21.strState
				,i21.strCountry
				,i21.strPhone
				,i21.strFax
				,i21.strWebsite
				,i21.strEmail
				,i21.intCheckStartingNo
				,i21.intCheckEndingNo
				,i21.intCheckNextNo
				,i21.ysnCheckEnableMICRPrint
				,i21.ysnCheckDefaultToBePrinted
				,i21.intBackupCheckStartingNo
				,i21.intBackupCheckEndingNo
				,i21.intEFTNextNo
				,i21.intEFTBankFileFormatId
				,i21.strEFTCompanyId
				,i21.strEFTBankName
				,i21.strMICRDescription
				,i21.intMICRBankAccountSpacesCount
				,i21.intMICRBankAccountSpacesPosition
				,i21.intMICRCheckNoSpacesCount
				,i21.intMICRCheckNoSpacesPosition
				,i21.intMICRCheckNoLength
				,i21.intMICRCheckNoPosition
				,i21.strMICRLeftSymbol
				,i21.strMICRRightSymbol
				,i21.intCreatedUserId
				,i21.dtmCreated
				,i21.intLastModifiedUserId
				,i21.dtmLastModified
				,i21.strCbkNo
				,i21.intConcurrencyId
				-- The following fields are from the origin system		
				,origin.apcbk_comment				-- CHAR (30)
				,apcbk_password = ISNULL(origin.apcbk_password, '''')	-- CHAR (16)
				,origin.apcbk_show_bal_yn			-- Y/N
				,origin.apcbk_prompt_align_yn		-- Y/N
				,origin.apcbk_chk_clr_ord_dn		-- Y/N
				,origin.apcbk_import_export_yn		-- Y/N
				,origin.apcbk_export_cbk_no			-- CHAR (2)
				,origin.apcbk_stmt_lock_rev_dt		-- INT yyyymmdd
				,origin.apcbk_gl_close_rev_dt		-- INT yyyymmdd
				,origin.apcbk_check_format_cs		-- CHAR (2)
				,origin.apcbk_laser_down_lines		-- INT
				,origin.apcbk_prtr_checks			-- CHAR (80)
				,origin.apcbk_auto_assign_trx_yn	-- Y/N
		FROM	dbo.tblCMBankAccount i21 LEFT JOIN dbo.apcbkmst_origin origin
					ON i21.strCbkNo = origin.apcbk_no COLLATE Latin1_General_CI_AS
		')

	EXEC('
		CREATE TRIGGER trg_delete_vwCMBankAccount
		ON [dbo].vwCMBankAccount
		INSTEAD OF DELETE
		AS
		BEGIN 

			SET NOCOUNT ON

			------------------------------------------------------------------------------------------
			-- Validate the checkbook first before deleting the record. Prevent delete if: 
			------------------------------------------------------------------------------------------
			-- 1. ...if checkbook is used in apivcmst (Accounts Payable Invoice File)
			IF EXISTS (
				SELECT	TOP 1 1 
				FROM	deleted d INNER JOIN dbo.apivcmst origin 
							ON d.strCbkNo = origin.apivc_cbk_no COLLATE Latin1_General_CI_AS
				WHERE	ISNULL(d.strCbkNo, '''') <> ''''
			)
			BEGIN
				RAISERROR(50012, 11, 1)	-- ''Unable to delete checkbook because it is used in the A/P Invoice file.''
				GOTO EXIT_TRIGGER
			END
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER

			-- 2. ...if checkbook is used in apchkmst (Check History File)
			IF EXISTS (
				SELECT	TOP 1 1 
				FROM	deleted d INNER JOIN dbo.apchkmst origin 
							ON d.strCbkNo = origin.apchk_cbk_no COLLATE Latin1_General_CI_AS
				WHERE	ISNULL(d.strCbkNo, '''') <> ''''
			)
			BEGIN
				RAISERROR(50013, 11, 1)	-- ''Unable to delete checkbook because it is used in the Check History file.''
				GOTO EXIT_TRIGGER
			END
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER

			-- 3. ...if checkbook is used in aptrxmst (A/P Trans File)
			IF EXISTS (
				SELECT	TOP 1 1 
				FROM	deleted d INNER JOIN dbo.aptrxmst origin 
							ON d.strCbkNo = origin.aptrx_cbk_no COLLATE Latin1_General_CI_AS
				WHERE	ISNULL(d.strCbkNo, '''') <> ''''
			)
			BEGIN
				RAISERROR(50014, 11, 1)	-- ''Unable to delete checkbook because it is used in the A/P Transaction file.''
				GOTO EXIT_TRIGGER
			END
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER

			------------------------------------------------------------------------------------------
			-- Below deletes the record
			------------------------------------------------------------------------------------------
			-- Delete records from i21 bank account table. 
			DELETE	dbo.tblCMBankAccount
			FROM	dbo.tblCMBankAccount 
			WHERE	intBankAccountId IN (SELECT d.intBankAccountId FROM deleted d)
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER

			-- Delete records in origin bank account table (apcbkmst_origin). 
			DELETE	dbo.apcbkmst_origin
			FROM	deleted d INNER JOIN dbo.apcbkmst_origin origin
						ON d.strCbkNo = origin.apcbk_no COLLATE Latin1_General_CI_AS
			WHERE	ISNULL(d.strCbkNo, '''') <> ''''
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER

		EXIT_TRIGGER:

		END
		')
	EXEC('
		CREATE TRIGGER trg_insert_vwCMBankAccount
		ON [dbo].vwCMBankAccount
		INSTEAD OF INSERT
		AS
		BEGIN 

		SET NOCOUNT ON 

			-- Proceed in inserting the record the base table (tblCMBankAccount)			
			INSERT INTO tblCMBankAccount (
					intBankId
					,ysnActive
					,intGLAccountId
					,intCurrencyId
					,intBankAccountType
					,strContact
					,strBankAccountNo
					,strRTN
					,strAddress
					,strZipCode
					,strCity
					,strState
					,strCountry
					,strPhone
					,strFax
					,strWebsite
					,strEmail
					,intCheckStartingNo
					,intCheckEndingNo
					,intCheckNextNo
					,ysnCheckEnableMICRPrint
					,ysnCheckDefaultToBePrinted
					,intBackupCheckStartingNo
					,intBackupCheckEndingNo
					,intEFTNextNo
					,intEFTBankFileFormatId
					,strEFTCompanyId
					,strEFTBankName
					,strMICRDescription
					,intMICRBankAccountSpacesCount
					,intMICRBankAccountSpacesPosition
					,intMICRCheckNoSpacesCount
					,intMICRCheckNoSpacesPosition
					,intMICRCheckNoLength
					,intMICRCheckNoPosition
					,strMICRLeftSymbol
					,strMICRRightSymbol
					,intCreatedUserId
					,dtmCreated
					,intLastModifiedUserId
					,dtmLastModified
					,intConcurrencyId
					,strCbkNo
			)
			OUTPUT 	inserted.intBankAccountId
			SELECT	intBankId							= i.intBankId
					,ysnActive							= i.ysnActive
					,intGLAccountId						= i.intGLAccountId
					,intCurrencyId						= i.intCurrencyId
					,intBankAccountType					= i.intBankAccountType
					,strContact							= i.strContact
					,strBankAccountNo					= i.strBankAccountNo
					,strRTN								= i.strRTN
					,strAddress							= i.strAddress
					,strZipCode							= i.strZipCode
					,strCity							= i.strCity
					,strState							= i.strState
					,strCountry							= i.strCountry
					,strPhone							= i.strPhone
					,strFax								= i.strFax
					,strWebsite							= i.strWebsite
					,strEmail							= i.strEmail
					,intCheckStartingNo					= i.intCheckStartingNo
					,intCheckEndingNo					= i.intCheckEndingNo
					,intCheckNextNo						= i.intCheckNextNo
					,ysnCheckEnableMICRPrint			= i.ysnCheckEnableMICRPrint
					,ysnCheckDefaultToBePrinted			= i.ysnCheckDefaultToBePrinted
					,intBackupCheckStartingNo			= i.intBackupCheckStartingNo
					,intBackupCheckEndingNo				= i.intBackupCheckEndingNo
					,intEFTNextNo						= i.intEFTNextNo
					,intEFTBankFileFormatId				= i.intEFTBankFileFormatId
					,strEFTCompanyId					= i.strEFTCompanyId
					,strEFTBankName						= i.strEFTBankName
					,strMICRDescription					= i.strMICRDescription
					,intMICRBankAccountSpacesCount		= i.intMICRBankAccountSpacesCount
					,intMICRBankAccountSpacesPosition	= i.intMICRBankAccountSpacesPosition
					,intMICRCheckNoSpacesCount			= i.intMICRCheckNoSpacesCount
					,intMICRCheckNoSpacesPosition		= i.intMICRCheckNoSpacesPosition
					,intMICRCheckNoLength				= i.intMICRCheckNoLength
					,intMICRCheckNoPosition				= i.intMICRCheckNoPosition
					,strMICRLeftSymbol					= i.strMICRLeftSymbol
					,strMICRRightSymbol					= i.strMICRRightSymbol
					,intCreatedUserId					= i.intCreatedUserId
					,dtmCreated							= i.dtmCreated
					,intLastModifiedUserId				= i.intLastModifiedUserId
					,dtmLastModified					= i.dtmLastModified
					,intConcurrencyId					= i.intConcurrencyId
					,strCbkNo							= i.strCbkNo
			FROM	inserted i 
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER

			-- INSERT new records for apcbkmst_origin
			INSERT INTO apcbkmst_origin (
					apcbk_no				
					,apcbk_currency			
					,apcbk_password			
					,apcbk_desc				
					,apcbk_bank_acct_no		
					,apcbk_comment			
					,apcbk_show_bal_yn		
					,apcbk_prompt_align_yn	
					,apcbk_chk_clr_ord_dn	
					,apcbk_import_export_yn	
					,apcbk_export_cbk_no	
					,apcbk_stmt_lock_rev_dt	
					,apcbk_gl_close_rev_dt	
					,apcbk_bal				
					,apcbk_next_chk_no		
					,apcbk_next_eft_no		
					,apcbk_check_format_cs	
					,apcbk_laser_down_lines	
					,apcbk_prtr_checks		
					,apcbk_auto_assign_trx_yn
					,apcbk_next_trx_no		
					,apcbk_transit_route	
					,apcbk_ach_company_id	
					,apcbk_ach_bankname		
					,apcbk_gl_cash			
					,apcbk_gl_ap			
					,apcbk_gl_disc			
					,apcbk_gl_wthhld		
					,apcbk_gl_curr			
					,apcbk_active_yn		
					,apcbk_bnk_no			
					,apcbk_user_id			
					,apcbk_user_rev_dt		
			)	
			SELECT 
					apcbk_no					= i.strCbkNo
					,apcbk_currency				= dbo.fn_GetCurrencyIdFromi21ToOrigin(i.intCurrencyId)
					,apcbk_password				= i.apcbk_password
					,apcbk_desc					= bank.strBankName COLLATE SQL_Latin1_General_CP1_CS_AS
					,apcbk_bank_acct_no			= i.strBankAccountNo COLLATE SQL_Latin1_General_CP1_CS_AS
					,apcbk_comment				= i.apcbk_comment 
					,apcbk_show_bal_yn			= i.apcbk_show_bal_yn
					,apcbk_prompt_align_yn		= i.apcbk_prompt_align_yn
					,apcbk_chk_clr_ord_dn		= i.apcbk_chk_clr_ord_dn
					,apcbk_import_export_yn		= i.apcbk_import_export_yn
					,apcbk_export_cbk_no		= i.apcbk_export_cbk_no
					,apcbk_stmt_lock_rev_dt		= i.apcbk_stmt_lock_rev_dt
					,apcbk_gl_close_rev_dt		= i.apcbk_gl_close_rev_dt
					,apcbk_bal					= NULL
					,apcbk_next_chk_no			= NULL
					,apcbk_next_eft_no			= NULL 
					,apcbk_check_format_cs		= i.apcbk_check_format_cs
					,apcbk_laser_down_lines		= i.apcbk_laser_down_lines
					,apcbk_prtr_checks			= i.apcbk_prtr_checks
					,apcbk_auto_assign_trx_yn	= i.apcbk_auto_assign_trx_yn
					,apcbk_next_trx_no			= NULL
					,apcbk_transit_route		= NULL
					,apcbk_ach_company_id		= NULL
					,apcbk_ach_bankname			= NULL
					,apcbk_gl_cash				= dbo.fn_GetGLAccountIdFromi21ToOrigin(i.intGLAccountId)
					,apcbk_gl_ap				= NULL
					,apcbk_gl_disc				= NULL
					,apcbk_gl_wthhld			= NULL
					,apcbk_gl_curr				= 0
					,apcbk_active_yn			= CASE WHEN i.ysnActive = 1 THEN ''Y'' ELSE ''N'' END 
					,apcbk_bnk_no				= NULL
					,apcbk_user_id				= NULL 
					,apcbk_user_rev_dt			= 0
			FROM	inserted i INNER JOIN dbo.tblCMBank bank
						ON i.intBankId = bank.intBankId
			WHERE	ISNULL(i.strCbkNo, '''') <> ''''
			
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER
		 		
		EXIT_TRIGGER: 

		END
		')

	EXEC('
		CREATE TRIGGER trg_update_vwCMBankAccount
		ON [dbo].vwCMBankAccount
		INSTEAD OF UPDATE
		AS
		BEGIN 

		SET NOCOUNT ON

			-- Perform validation on strCbkNo field. 
			IF EXISTS (
				SELECT	TOP 1 1 
				FROM	inserted i
				WHERE	EXISTS (
							SELECT	TOP 1 1 
							FROM	dbo.tblCMBankAccount t 
							WHERE	t.intBankAccountId <> i.intBankAccountId 
									AND t.strCbkNo = i.strCbkNo 
									AND ISNULL(i.strCbkNo, '''') <> ''''
						)
			)
			BEGIN 
				RAISERROR(50011, 11, 1)	-- ''Duplicate checkbook id found.''
				GOTO EXIT_TRIGGER
			END 

			-- Proceed in updating the base table (tblCMBankAccount)				
			UPDATE	dbo.tblCMBankAccount 
			SET		intBankId							= i.intBankId
					,ysnActive							= i.ysnActive
					,intGLAccountId						= i.intGLAccountId
					,intCurrencyId						= i.intCurrencyId
					,intBankAccountType					= i.intBankAccountType
					,strContact							= i.strContact
					,strBankAccountNo					= i.strBankAccountNo
					,strRTN								= i.strRTN
					,strAddress							= i.strAddress
					,strZipCode							= i.strZipCode
					,strCity							= i.strCity
					,strState							= i.strState
					,strCountry							= i.strCountry
					,strPhone							= i.strPhone
					,strFax								= i.strFax
					,strWebsite							= i.strWebsite
					,strEmail							= i.strEmail
					,intCheckStartingNo					= i.intCheckStartingNo
					,intCheckEndingNo					= i.intCheckEndingNo
					,intCheckNextNo						= i.intCheckNextNo
					,ysnCheckEnableMICRPrint			= i.ysnCheckEnableMICRPrint
					,ysnCheckDefaultToBePrinted			= i.ysnCheckDefaultToBePrinted
					,intBackupCheckStartingNo			= i.intBackupCheckStartingNo
					,intBackupCheckEndingNo				= i.intBackupCheckEndingNo
					,intEFTNextNo						= i.intEFTNextNo
					,intEFTBankFileFormatId				= i.intEFTBankFileFormatId
					,strEFTCompanyId					= i.strEFTCompanyId
					,strEFTBankName						= i.strEFTBankName
					,strMICRDescription					= i.strMICRDescription
					,intMICRBankAccountSpacesCount		= i.intMICRBankAccountSpacesCount
					,intMICRBankAccountSpacesPosition	= i.intMICRBankAccountSpacesPosition
					,intMICRCheckNoSpacesCount			= i.intMICRCheckNoSpacesCount
					,intMICRCheckNoSpacesPosition		= i.intMICRCheckNoSpacesPosition
					,intMICRCheckNoLength				= i.intMICRCheckNoLength
					,intMICRCheckNoPosition				= i.intMICRCheckNoPosition
					,strMICRLeftSymbol					= i.strMICRLeftSymbol
					,strMICRRightSymbol					= i.strMICRRightSymbol
					,intCreatedUserId					= i.intCreatedUserId
					,dtmCreated							= i.dtmCreated
					,intLastModifiedUserId				= i.intLastModifiedUserId
					,dtmLastModified					= i.dtmLastModified
					,intConcurrencyId					= i.intConcurrencyId
					,strCbkNo							= i.strCbkNo
			FROM	inserted i INNER JOIN dbo.tblCMBankAccount B
						ON i.intBankAccountId = B.intBankAccountId

			IF @@ERROR <> 0 GOTO EXIT_TRIGGER
			
			-- UPDATE modified record for apcbkmst_origin
			UPDATE	dbo.apcbkmst_origin 
			SET		apcbk_no					= i.strCbkNo
					,apcbk_currency				= dbo.fn_GetCurrencyIdFromi21ToOrigin(i.intCurrencyId)
					,apcbk_password				= i.apcbk_password
					,apcbk_desc					= bank.strBankName COLLATE SQL_Latin1_General_CP1_CS_AS
					,apcbk_bank_acct_no			= i.strBankAccountNo COLLATE SQL_Latin1_General_CP1_CS_AS
					,apcbk_comment				= i.apcbk_comment 
					,apcbk_show_bal_yn			= i.apcbk_show_bal_yn
					,apcbk_prompt_align_yn		= i.apcbk_prompt_align_yn
					,apcbk_chk_clr_ord_dn		= i.apcbk_chk_clr_ord_dn
					,apcbk_import_export_yn		= i.apcbk_import_export_yn
					,apcbk_export_cbk_no		= i.apcbk_export_cbk_no
					,apcbk_stmt_lock_rev_dt		= i.apcbk_stmt_lock_rev_dt
					,apcbk_gl_close_rev_dt		= i.apcbk_gl_close_rev_dt
					--,apcbk_bal				= NULL
					--,apcbk_next_chk_no		= NULL
					--,apcbk_next_eft_no		= NULL 
					,apcbk_check_format_cs		= i.apcbk_check_format_cs
					,apcbk_laser_down_lines		= i.apcbk_laser_down_lines
					,apcbk_prtr_checks			= i.apcbk_prtr_checks
					,apcbk_auto_assign_trx_yn	= i.apcbk_auto_assign_trx_yn
					--,apcbk_next_trx_no		= NULL
					--,apcbk_transit_route		= NULL
					--,apcbk_ach_company_id		= NULL
					--,apcbk_ach_bankname		= NULL
					,apcbk_gl_cash				= dbo.fn_GetGLAccountIdFromi21ToOrigin(i.intGLAccountId)
					--,apcbk_gl_ap				= NULL
					--,apcbk_gl_disc			= NULL
					--,apcbk_gl_wthhld			= NULL
					--,apcbk_gl_curr			= 0
					,apcbk_active_yn			= CASE WHEN i.ysnActive = 1 THEN ''Y'' ELSE ''N'' END 
					--,apcbk_bnk_no				= NULL
					--,apcbk_user_id			= NULL 
					--,apcbk_user_rev_dt		= 0	
			FROM	inserted i INNER JOIN deleted d
						ON i.intBankAccountId = d.intBankAccountId
					INNER JOIN dbo.apcbkmst_origin origin
						ON d.strCbkNo = origin.apcbk_no COLLATE Latin1_General_CI_AS
					INNER JOIN dbo.tblCMBank bank
						ON i.intBankId = bank.intBankId
			WHERE	ISNULL(i.strCbkNo, '''') <> ''''
					AND ISNULL(d.strCbkNo, '''') <> ''''
							
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER			

			-- INSERT new records for apcbkmst_origin (if it does not exists)
			INSERT INTO apcbkmst_origin (
					apcbk_no				
					,apcbk_currency			
					,apcbk_password			
					,apcbk_desc				
					,apcbk_bank_acct_no		
					,apcbk_comment			
					,apcbk_show_bal_yn		
					,apcbk_prompt_align_yn	
					,apcbk_chk_clr_ord_dn	
					,apcbk_import_export_yn	
					,apcbk_export_cbk_no	
					,apcbk_stmt_lock_rev_dt	
					,apcbk_gl_close_rev_dt	
					,apcbk_bal				
					,apcbk_next_chk_no		
					,apcbk_next_eft_no		
					,apcbk_check_format_cs	
					,apcbk_laser_down_lines	
					,apcbk_prtr_checks		
					,apcbk_auto_assign_trx_yn
					,apcbk_next_trx_no		
					,apcbk_transit_route	
					,apcbk_ach_company_id	
					,apcbk_ach_bankname		
					,apcbk_gl_cash			
					,apcbk_gl_ap			
					,apcbk_gl_disc			
					,apcbk_gl_wthhld		
					,apcbk_gl_curr			
					,apcbk_active_yn		
					,apcbk_bnk_no			
					,apcbk_user_id			
					,apcbk_user_rev_dt		
			)	
			SELECT 
					apcbk_no					= i.strCbkNo
					,apcbk_currency				= dbo.fn_GetCurrencyIdFromi21ToOrigin(i.intCurrencyId)
					,apcbk_password				= i.apcbk_password
					,apcbk_desc					= bank.strBankName COLLATE SQL_Latin1_General_CP1_CS_AS
					,apcbk_bank_acct_no			= i.strBankAccountNo COLLATE SQL_Latin1_General_CP1_CS_AS
					,apcbk_comment				= i.apcbk_comment 
					,apcbk_show_bal_yn			= i.apcbk_show_bal_yn
					,apcbk_prompt_align_yn		= i.apcbk_prompt_align_yn
					,apcbk_chk_clr_ord_dn		= i.apcbk_chk_clr_ord_dn
					,apcbk_import_export_yn		= i.apcbk_import_export_yn
					,apcbk_export_cbk_no		= i.apcbk_export_cbk_no
					,apcbk_stmt_lock_rev_dt		= i.apcbk_stmt_lock_rev_dt
					,apcbk_gl_close_rev_dt		= i.apcbk_gl_close_rev_dt
					,apcbk_bal					= NULL
					,apcbk_next_chk_no			= NULL
					,apcbk_next_eft_no			= NULL 
					,apcbk_check_format_cs		= i.apcbk_check_format_cs
					,apcbk_laser_down_lines		= i.apcbk_laser_down_lines
					,apcbk_prtr_checks			= i.apcbk_prtr_checks
					,apcbk_auto_assign_trx_yn	= i.apcbk_auto_assign_trx_yn
					,apcbk_next_trx_no			= NULL
					,apcbk_transit_route		= NULL
					,apcbk_ach_company_id		= NULL
					,apcbk_ach_bankname			= NULL
					,apcbk_gl_cash				= dbo.fn_GetGLAccountIdFromi21ToOrigin(i.intGLAccountId)
					,apcbk_gl_ap				= NULL
					,apcbk_gl_disc				= NULL
					,apcbk_gl_wthhld			= NULL
					,apcbk_gl_curr				= 0
					,apcbk_active_yn			= CASE WHEN i.ysnActive = 1 THEN ''Y'' ELSE ''N'' END 
					,apcbk_bnk_no				= NULL
					,apcbk_user_id				= NULL 
					,apcbk_user_rev_dt			= 0
			FROM	inserted i INNER JOIN dbo.tblCMBank bank
						ON i.intBankId = bank.intBankId
			WHERE	ISNULL(i.strCbkNo, '''') <> ''''
					AND NOT EXISTS (SELECT TOP 1 1 FROM dbo.apcbkmst_origin origin WHERE origin.apcbk_no COLLATE Latin1_General_CI_AS = i.strCbkNo)			
			IF @@ERROR <> 0 GOTO EXIT_TRIGGER

		EXIT_TRIGGER:
		END
		')
GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwcmtmst')
	DROP VIEW vwcmtmst
GO
--AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwcmtmst]
		AS
		SELECT
		vwcmt_cus_no				=agcmt_cus_no
		,vwcmt_com_typ				=agcmt_com_typ
		,vwcmt_com_cd				=CAST(agcmt_com_cd AS CHAR(4))
		,vwcmt_com_seq				=CAST(agcmt_com_seq AS CHAR(4))
		,vwcmt_data					=agcmt_data
		,vwcmt_payee_1				=agcmt_payee_1
		,vwcmt_payee_2				=agcmt_payee_2
		,vwcmt_rc_lic_no			=agcmt_rc_lic_no
		,vwcmt_rc_exp_rev_dt		=agcmt_rc_exp_rev_dt
		,vwcmt_rc_comment			=agcmt_rc_comment
		,vwcmt_rc_custom_yn			=CAST(agcmt_rc_custom_yn AS CHAR(4))
		,vwcmt_tr_ins_no			=agcmt_tr_ins_no
		,vwcmt_tr_exp_rev_dt		=agcmt_tr_exp_rev_dt
		,vwcmt_tr_comment			=agcmt_tr_comment
		,vwcmt_ord_comment1			=agcmt_ord_comment1
		,vwcmt_ord_comment2			=CAST(agcmt_ord_comment2 AS CHAR(60))
		,vwcmt_fax_contact			=agcmt_fax_contact
		,vwcmt_fax_to_fax_num		=agcmt_fax_to_fax_num
		,vwcmt_eml_contact			=agcmt_eml_contact
		,vwcmt_eml_address			=agcmt_eml_address
		,vwcmt_stl_lic_no			=agcmt_stl_lic_no
		,vwcmt_stl_exp_rev_dt		=agcmt_stl_exp_rev_dt
		,vwcmt_stl_comment			=agcmt_stl_comment
		,vwcmt_user_id				=agcmt_user_id
		,vwcmt_user_rev_dt			=agcmt_user_rev_dt
		,A4GLIdentity	= CAST(A4GLIdentity   AS INT)
		FROM agcmtmst
		')

GO

-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwcmtmst]
		AS
		SELECT
			vwcmt_cus_no				=ptcmt_cus_no
			,vwcmt_com_typ				=ptcmt_type
			,vwcmt_com_cd				=CAST(NULL AS CHAR(4))
			,vwcmt_com_seq				=CAST(ptcmt_seq_no AS CHAR(2))  
			,vwcmt_data					=CAST(NULL AS CHAR(69)) 
			,vwcmt_payee_1				=CAST(NULL AS CHAR(30))
			,vwcmt_payee_2				=CAST(NULL AS CHAR(30)) 
			,vwcmt_rc_lic_no			=CAST(NULL AS CHAR(12))
			,vwcmt_rc_exp_rev_dt		=NULL
			,vwcmt_rc_comment			=CAST(NULL AS CHAR(30))
			,vwcmt_rc_custom_yn			=CAST(NULL AS CHAR(4))
			,vwcmt_tr_ins_no			=CAST(NULL AS CHAR(12))
			,vwcmt_tr_exp_rev_dt		=NULL
			,vwcmt_tr_comment			=CAST(NULL AS CHAR(30))
			,vwcmt_ord_comment1			=CAST(NULL AS CHAR(30))
			,vwcmt_ord_comment2			=CAST(ptcmt_comment AS CHAR(60))
			,vwcmt_fax_contact			=CAST(NULL AS CHAR(30))
			,vwcmt_fax_to_fax_num		=CAST(NULL AS CHAR(24))
			,vwcmt_eml_contact			=CAST(NULL AS CHAR(30))
			,vwcmt_eml_address			=CAST(NULL AS CHAR(39))
			,vwcmt_stl_lic_no			=CAST(NULL AS CHAR(15))
			,vwcmt_stl_exp_rev_dt		=NULL
			,vwcmt_stl_comment			=CAST(NULL AS CHAR(30)) 
			,vwcmt_user_id				=CAST(NULL AS CHAR(16))
			,vwcmt_user_rev_dt			=NULL
			,A4GLIdentity	= CAST(A4GLIdentity   AS INT)
			FROM ptcmtmst
		
		')
GO




IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwcntmst')
	DROP VIEW vwcntmst

-- CONTRACTS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'CN' and strDBName = db_name()	) = 1
-- AG VIEW
	IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
		EXEC ('
			CREATE VIEW [dbo].[vwcntmst]
			AS
			SELECT
			vwcnt_cus_no=agcnt_cus_no
			,vwcnt_cnt_no= agcnt_cnt_no
			,vwcnt_line_no= agcnt_line_no
			,vwcnt_alt_cus=agcnt_alt_cus
			,vwcnt_itm_or_cls=agcnt_itm_or_cls
			,vwcnt_loc_no=agcnt_loc_no
			,vwcnt_alt_cnt_no=agcnt_alt_cnt_no
			,vwcnt_amt_orig=agcnt_amt_orig
			,vwcnt_amt_bal=agcnt_amt_bal
			,vwcnt_due_rev_dt= CONVERT(DATETIME, SUBSTRING(CAST(agcnt_due_rev_dt AS NVARCHAR(8)),1,4) + ''/'' 
											+ SUBSTRING(CAST(agcnt_due_rev_dt AS NVARCHAR(8)),5,2) + ''/'' 
											+  SUBSTRING(CAST(agcnt_due_rev_dt AS NVARCHAR(8)),7,2), 101) -- yyy/mm/dd
			,vwcnt_hdr_comments=agcnt_hdr_comments
			,vwcnt_un_orig=agcnt_un_orig
			,vwcnt_un_bal=agcnt_un_bal
			,vwcnt_lc1_yn=agcnt_lc1_yn
			,vwcnt_lc2_yn=agcnt_lc2_yn
			,vwcnt_lc3_yn=agcnt_lc3_yn
			,vwcnt_lc4_yn =agcnt_lc4_yn
			,vwcnt_lc5_yn =agcnt_lc5_yn
			,vwcnt_lc6_yn =agcnt_lc6_yn
			,vwcnt_ppd_yndm =agcnt_ppd_yndm
			,vwcnt_un_prc=agcnt_un_prc
			,vwcnt_prc_lvl = agcnt_prc_lvl
			,A4GLIdentity = CAST(A4GLIdentity   AS INT)

			FROM agcntmst
			')
			
-- PT VIEW
	IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
		EXEC ('
			CREATE VIEW [dbo].[vwcntmst]
			AS
			SELECT
			vwcnt_cus_no=ptcnt_cus_no
			,vwcnt_cnt_no= CAST(ptcnt_cnt_no AS CHAR(8))  
			,vwcnt_line_no= ptcnt_line_no
			,vwcnt_alt_cus=ptcnt_alt_cus_no
			,vwcnt_itm_or_cls=CAST(ptcnt_itm_or_cls AS CHAR(13))  
			,vwcnt_loc_no=ptcnt_loc_no
			,vwcnt_alt_cnt_no=CAST(ptcnt_alt_cnt_no AS CHAR(8)) 
			,vwcnt_amt_orig=ptcnt_amt_orig
			,vwcnt_amt_bal=ptcnt_amt_bal
			,vwcnt_due_rev_dt= CONVERT(DATETIME, SUBSTRING(CAST(ptcnt_due_rev_dt AS NVARCHAR(8)),1,4) + ''/'' 
											+ SUBSTRING(CAST(ptcnt_due_rev_dt AS NVARCHAR(8)),5,2) + ''/'' 
											+  SUBSTRING(CAST(ptcnt_due_rev_dt AS NVARCHAR(8)),7,2), 101) -- yyy/mm/dd
			,vwcnt_hdr_comments=ptcnt_hdr_comments
			,vwcnt_un_orig=ptcnt_un_orig
			,vwcnt_un_bal=ptcnt_un_bal
			,vwcnt_lc1_yn=ptcnt_lc1_yn
			,vwcnt_lc2_yn=ptcnt_lc2_yn
			,vwcnt_lc3_yn=ptcnt_lc3_yn
			,vwcnt_lc4_yn =ptcnt_lc4_yn
			,vwcnt_lc5_yn =ptcnt_lc5_yn
			,vwcnt_lc6_yn =ptcnt_lc6_yn
			,vwcnt_ppd_yndm =ptcnt_prepaid_ynd
			,vwcnt_un_prc=CAST(0.00 AS DECIMAL(18,6))  
			,vwcnt_prc_lvl = ptcnt_prc_lvl
			,A4GLIdentity = CAST(A4GLIdentity   AS INT)
			FROM ptcntmst
			')
			
GO


IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwcoctlmst')
	DROP VIEW vwcoctlmst
GO

CREATE VIEW [dbo].[vwcoctlmst]
AS
SELECT
vwcoctl_le_yn = coctl_le_yn
,vwctl_sp_yn = coctl_sp_yn
,A4GLIdentity = CAST(A4GLIdentity   AS INT)
FROM
coctlmst

GO

-- CUSTOMER PORTAL
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPAgcusMst')
	DROP VIEW vwCPAgcusMst

GO
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPAgcusMst]
			AS SELECT
			agcus_key			COLLATE Latin1_General_CI_AS as strCustomerNo,
			agcus_first_name	COLLATE Latin1_General_CI_AS as strCustomerFirstName,
			agcus_last_name		COLLATE Latin1_General_CI_AS as strCustomerLastName,
			CAST(A4GLIdentity AS INT) as A4GLIdentity	
		FROM agcusmst
		')
GO
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPAgcusMst]
			AS SELECT
			ptcus_cus_no			COLLATE Latin1_General_CI_AS as strCustomerNo,
			ptcus_first_name	COLLATE Latin1_General_CI_AS as strCustomerFirstName,
			ptcus_last_name		COLLATE Latin1_General_CI_AS as strCustomerLastName,
			CAST(A4GLIdentity AS INT) as A4GLIdentity	
		FROM ptcusmst
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPBABusinessSummary')
	DROP VIEW vwCPBABusinessSummary

GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPBABusinessSummary]
		AS
		select
			A4GLIdentity = row_number() over (order by a.agstm_loc_no)
			,strCustomerNo = a.agstm_bill_to_cus
			,strItem = a.agstm_itm_no
			,strLocation = a.agstm_loc_no
			,strClass = a.agstm_class
			,strDescription = b.agitm_desc
			,strUnitDescription = b.agitm_un_desc
			,strClassDescription = c.agcls_desc
			,strAdjustmentInventory = a.agstm_adj_inv_yn
			,a.agstm_fet_amt
			,a.agstm_set_amt
			,a.agstm_sst_amt
			,a.agstm_ppd_amt_applied
			,dblQuantity = a.agstm_un
			,dblAmount = a.agstm_sls
			,dtmShipmentDate = (case len(convert(varchar, a.agstm_ship_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agstm_ship_rev_dt) AS CHAR(12)), 112) else null end)
			,dblTotalAmount = 0.00
		from
			agstmmst a
		left outer join
			agclsmst c
			on a.agstm_class = c.agcls_cd
		left outer join
			agitmmst b
			on a.agstm_itm_no = b.agitm_no
			and a.agstm_loc_no = b.agitm_loc_no 
		where
			(a.agstm_rec_type = ''5'')
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPBABusinessSummary]
		AS
		select 1 xx
		')

GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPaymentsDetails')
	DROP VIEW vwCPPaymentsDetails
GO
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPaymentsDetails]
		AS
		select
			strCustomerName = rtrim(ltrim(c.agcus_first_name)) + '' '' + rtrim(ltrim(c.agcus_last_name))
			,strCustomerNo = agpay_cus_no
			,strCheckNo = agpay_chk_no
			,dblAmount = agpay_amt
			,strLocationNo = agpay_ivc_loc_no
			,strCreditInd = agpay_cred_ind
			,strReferenceNo = agpay_ref_no
			,dtmDate = (case len(convert(varchar, agpay_orig_rev_dt)) when 8 then convert(date, cast(convert(varchar, agpay_orig_rev_dt) AS CHAR(12)), 112) else null end)
			,strNote = agpay_note
			,strInvoiceNo = agpay_ivc_no
		from
			agpaymst a, agcusmst c where c.agcus_key = agpay_cus_no
		--where agpay_orig_rev_dt between 20120816 and 20131211 and agpay_cus_no = ''0000000505''
		union all
		select
			strCustomerName = rtrim(ltrim(c.agcus_first_name)) + '' '' + rtrim(ltrim(c.agcus_last_name))
			,strCustomerNo = a.agpye_cus_no
			,strCheckNo = a.agpye_chk_no
			,dblAmount = a.agpye_amt
			,strLocationNo = a.agpye_ivc_loc_no
			,strCreditInd = a.agpye_cred_ind
			,strReferenceNo = a.agpye_ref_no
			,dtmDate = (case len(convert(varchar, a.agpye_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agpye_rev_dt) AS CHAR(12)), 112) else null end)
			,strNote = a.agpye_note
			,strInvoiceNo = b.agivc_ivc_no
		from
			agpyemst a
		left outer join
			agivcmst b on a.agpye_cus_no = b.agivc_bill_to_cus
			and a.agpye_inc_ref = b.agivc_ivc_no
			and a.agpye_ivc_loc_no = b.agivc_loc_no 
		left outer join
			agcusmst c on c.agcus_key = a.agpye_cus_no
		--where a.agpye_rev_dt between 20120816 and 20131211 and a.agpye_cus_no = ''0000000505''
		union all
		SELECT
			strCustomerName = rtrim(ltrim(c.agcus_first_name)) + '' '' + rtrim(ltrim(c.agcus_last_name))
			,strCustomerNo = a.agcrd_cus_no
			,strCheckNo = ''Unapplied''
			,dblAmount = SUM(a.agcrd_amt - a.agcrd_amt_used)
			,strLocationNo = a.agcrd_loc_no
			,strCreditInd = a.agcrd_cred_ind
			,strReferenceNo = a.agcrd_ref_no
			,dtmDate = (case len(convert(varchar, a.agcrd_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agcrd_rev_dt) AS CHAR(12)), 112) else null end)
			,strNote = a.agcrd_note
			,strInvoiceNo = null
		FROM
			agcrdmst a, agcusmst c
		WHERE
			(a.agcrd_amt_used <> a.agcrd_amt)
			AND (a.agcrd_type IN (''P'', ''A''))
			and c.agcus_key = a.agcrd_cus_no
		--	and agcrd_rev_dt between 20120816 and 20131211 and agcrd_cus_no = ''0000000505''
		GROUP BY
			c.agcus_first_name
			,c.agcus_last_name
			,a.agcrd_loc_no
			,a.agcrd_cred_ind
			,a.agcrd_ref_no
			,a.agcrd_rev_dt
			,a.agcrd_cus_no
			,a.agcrd_note
		')

GO

IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPaymentsDetails]
		AS
		select 1 XX
		')
GO



IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPBillingAccountPayments')
	DROP VIEW vwCPBillingAccountPayments
GO

CREATE VIEW [dbo].[vwCPBillingAccountPayments]
AS
SELECT
	   id = row_number() over (order by dblAmount)
      ,strCustomerNo
	  ,dtmDate
      ,strCheckNo
      ,dblAmount = sum(dblAmount)
  FROM vwCPPaymentsDetails
  GROUP BY dblAmount, dtmDate, strCheckNo,strCustomerNo
  --order by dtmDate
GO


IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPContracts')
	DROP VIEW vwCPContracts
GO

--CONTRACTS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'CN' and strDBName = db_name()	) = 1
BEGIN
	-- AG VIEW
	IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
		EXEC ('
			CREATE VIEW [dbo].[vwCPContracts]
			AS
			select distinct
				a.A4GLIdentity
				,a.agcnt_cnt_no
				,a.agcnt_loc_no
				,a.agcnt_amt_bal
				,agcnt_due_rev_dt = (case len(convert(varchar, a.agcnt_due_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agcnt_due_rev_dt) AS CHAR(12)), 112) else null end)
				,a.agcnt_hdr_comments
				,a.agcnt_ppd_yndm
				,a.agcnt_itm_or_cls
				,b.agitm_no
				,b.agitm_un_desc
				,a.agcnt_line_no
				,a.agcnt_un_bal
				,a.agcnt_cus_no
				, strStatus = (case when a.agcnt_un_bal > 0 then ''Open'' else ''Closed'' end)
			from
				agcntmst a
			left outer join
				agitmmst b 
				on 
					a.agcnt_itm_or_cls = b.agitm_no
					and a.agcnt_loc_no = b.agitm_loc_no
			where
				(a.agcnt_itm_or_cls <> ''*'')
				and (a.agcnt_line_no <> 0)
			')
	-- PT VIEW
	IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
		EXEC ('
			CREATE VIEW [dbo].[vwCPContracts]
			AS
			select 1 XX
			')	
END
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPCurrentCashBids')
	DROP VIEW vwCPCurrentCashBids

-- GRAINS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPCurrentCashBids]
		AS
		select
			a.A4GLIdentity
			,a.gaprc_com_cd
			,a.gaprc_un_cash_prc
			,b.gacom_desc
			,a.gaprc_loc_no
			,c.galoc_desc
			
		from
			gacommst b
		right outer join
			gaprcmst a
			on b.gacom_com_cd = a.gaprc_com_cd
		left join
			galocmst c
			on c.galoc_loc_no = a.gaprc_loc_no
		where
			(a.gaprc_un_cash_prc > 0)
		')
GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPDatabaseDate')
	DROP VIEW vwCPDatabaseDate
GO

CREATE VIEW [dbo].[vwCPDatabaseDate]
AS
select
	id = 1
	,dbdate = GETDATE()

GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPGABusinessSummary')
	DROP VIEW vwCPGABusinessSummary
GO
-- GRAINS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPGABusinessSummary]
		AS
		WITH GAS
		AS 
		(
			SELECT 
			 CASE WHEN (ISNULL(a.gastl_shrk_what_1, '''') <> '''' and a.gastl_shrk_what_1 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_1)
				  WHEN (ISNULL(a.gastl_shrk_what_1, '''') <> '''' and a.gastl_shrk_what_1 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_1 + a.gastl_shrk_pct_1 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_2, '''') <> '''' and a.gastl_shrk_what_2 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_2)
				  WHEN (ISNULL(a.gastl_shrk_what_2, '''') <> '''' and a.gastl_shrk_what_2 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_2 + a.gastl_shrk_pct_2 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_3, '''') <> '''' and a.gastl_shrk_what_3 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_3)
				  WHEN (ISNULL(a.gastl_shrk_what_3, '''') <> '''' and a.gastl_shrk_what_3 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_3 + a.gastl_shrk_pct_3 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_4, '''') <> '''' and a.gastl_shrk_what_4 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_4)
				  WHEN (ISNULL(a.gastl_shrk_what_4, '''') <> '''' and a.gastl_shrk_what_4 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_4 + a.gastl_shrk_pct_4 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_5, '''') <> '''' and a.gastl_shrk_what_5 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_5)
				  WHEN (ISNULL(a.gastl_shrk_what_5, '''') <> '''' and a.gastl_shrk_what_5 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_5 + a.gastl_shrk_pct_5 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_6, '''') <> '''' and a.gastl_shrk_what_6 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_6)
				  WHEN (ISNULL(a.gastl_shrk_what_6, '''') <> '''' and a.gastl_shrk_what_6 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_6 + a.gastl_shrk_pct_6 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_7, '''') <> '''' and a.gastl_shrk_what_7 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_7)
				  WHEN (ISNULL(a.gastl_shrk_what_7, '''') <> '''' and a.gastl_shrk_what_7 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_7 + a.gastl_shrk_pct_7 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_8, '''') <> '''' and a.gastl_shrk_what_8 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_8)
				  WHEN (ISNULL(a.gastl_shrk_what_8, '''') <> '''' and a.gastl_shrk_what_8 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_8 + a.gastl_shrk_pct_8 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_9, '''') <> '''' and a.gastl_shrk_what_9 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_9)
				  WHEN (ISNULL(a.gastl_shrk_what_9, '''') <> '''' and a.gastl_shrk_what_9 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_9 + a.gastl_shrk_pct_9 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_10, '''') <> '''' and a.gastl_shrk_what_10 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_10)
				  WHEN (ISNULL(a.gastl_shrk_what_10, '''') <> '''' and a.gastl_shrk_what_10 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_10 + a.gastl_shrk_pct_10 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_11, '''') <> '''' and a.gastl_shrk_what_11 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_11)
				  WHEN (ISNULL(a.gastl_shrk_what_11, '''') <> '''' and a.gastl_shrk_what_11 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_11 + a.gastl_shrk_pct_11 / 100 * a.gastl_un_prc)
				  WHEN (ISNULL(a.gastl_shrk_what_12, '''') <> '''' and a.gastl_shrk_what_12 <> ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_12)
				  WHEN (ISNULL(a.gastl_shrk_what_12, '''') <> '''' and a.gastl_shrk_what_12 = ''P'') THEN (a.gastl_no_un * a.gastl_un_disc_amt_12 + a.gastl_shrk_pct_12 / 100 * a.gastl_un_prc)
			END AS drying, a.A4GLIdentity
			FROM gastlmst a
		),
		GAS2
		as
		(
			SELECT 
			 CASE WHEN (ISNULL(a.gastl_ckoff_amt, 0) <> 0 and ISNULL(a.gastl_ins_amt, 0) <> 0 and ISNULL(a.gastl_fees_pd, 0) <> 0) THEN (isnumeric(a.gastl_ckoff_amt) + isnumeric(a.gastl_ins_amt) + isnumeric(a.gastl_fees_pd))
				  WHEN (ISNULL(a.gastl_ckoff_amt, 0) <> 0 and ISNULL(a.gastl_ins_amt, 0) <> 0 and ISNULL(a.gastl_fees_pd, 0) = 0) THEN (isnumeric(a.gastl_ckoff_amt) + isnumeric(a.gastl_ins_amt))
				  WHEN (ISNULL(a.gastl_ckoff_amt, 0) <> 0 and ISNULL(a.gastl_ins_amt, 0) <> 0 and ISNULL(a.gastl_fees_pd, 0) <> 0) THEN (isnumeric(a.gastl_ckoff_amt) + isnumeric(a.gastl_fees_pd))
				  WHEN (ISNULL(a.gastl_ckoff_amt, 0) <> 0 and ISNULL(a.gastl_ins_amt, 0) = 0 and ISNULL(a.gastl_fees_pd, 0) = 0) THEN (isnumeric(a.gastl_ckoff_amt))
				  
				  WHEN (ISNULL(a.gastl_ckoff_amt, 0) = 0 and ISNULL(a.gastl_ins_amt, 0) <> 0 and ISNULL(a.gastl_fees_pd, 0) <> 0) THEN (isnumeric(a.gastl_ins_amt) + isnumeric(a.gastl_fees_pd))
				  WHEN (ISNULL(a.gastl_ckoff_amt, 0) = 0 and ISNULL(a.gastl_ins_amt, 0) <> 0 and ISNULL(a.gastl_fees_pd, 0) = 0) THEN (isnumeric(a.gastl_ins_amt))
				  WHEN (ISNULL(a.gastl_ckoff_amt, 0) = 0 and ISNULL(a.gastl_ins_amt, 0) <> 0 and ISNULL(a.gastl_fees_pd, 0) <> 0) THEN (isnumeric(a.gastl_fees_pd))
			END AS chkIns, a.A4GLIdentity
			FROM gastlmst a
		),
		GAS3
		as
		(
			SELECT 
			 CASE WHEN (ISNULL(a.gastl_rec_type, '''') = ''J'' and isnumeric(a.gastl_adj_ckoff_amt) <> 0 and ISNULL(b.gacom_ckoff_desc, '''') <> '''') THEN b.gacom_ckoff_desc+''=''+convert(varchar,a.gastl_adj_ckoff_amt)
				  WHEN (ISNULL(a.gastl_rec_type, '''') = ''J'' and isnumeric(a.gastl_adj_ckoff_amt) <> 0 and ISNULL(b.gacom_ckoff_desc, '''') = '''') THEN ''CKOFF=''+convert(varchar,a.gastl_adj_ckoff_amt)
			else ''''
			END AS recType, a.A4GLIdentity
			FROM gastlmst a, gacommst b where b.gacom_com_cd = a.gastl_com_cd and a.gastl_pur_sls_ind = ''P''
		),
		GAS4
		as
		(
			SELECT 
			 CASE WHEN ISNULL(a.gastl_rec_type, '''') = '''' THEN ''''
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''M'' THEN ''SPOT SALE''
				  WHEN (ISNULL(a.gastl_rec_type, '''') = ''C'' and isnull(a.gastl_cnt_no,'''') = '''') THEN ''CONT''
				  WHEN (ISNULL(a.gastl_rec_type, '''') = ''C'' and isnull(a.gastl_cnt_no,'''') <> '''') THEN ''CONT ''+Convert(varchar,a.gastl_cnt_no)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''F'' THEN ''FREIGHT @''+Convert(varchar,a.gastl_frt_rt)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''I'' THEN ''INTEREST''
				  WHEN (ISNULL(a.gastl_rec_type, '''') = ''J'' and isnumeric(a.gastl_adj_ins_amt) <> 0 and ISNULL(b.gacom_ckoff_desc, '''') <> '''') THEN b.gacom_ckoff_desc+''=''+convert(varchar,a.gastl_adj_ins_amt)
				  WHEN (ISNULL(a.gastl_rec_type, '''') = ''J'' and isnumeric(a.gastl_adj_ins_amt) <> 0 and ISNULL(b.gacom_ckoff_desc, '''') = '''') THEN ''INS=''+convert(varchar,a.gastl_adj_ins_amt)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''D'' THEN ''BILLED ADV''
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''1'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_1, '''') from ecctlmst e)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''2'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_2, '''') from ecctlmst e)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''3'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_3, '''') from ecctlmst e)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''4'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_4, '''') from ecctlmst e)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''5'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_5, '''') from ecctlmst e)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''6'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_6, '''') from ecctlmst e)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''7'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_7, '''') from ecctlmst e)
				  WHEN ISNULL(a.gastl_rec_type, '''') = ''8'' THEN (select top 1 isnull(e.ecctl_ga_stor_desc_8, '''') from ecctlmst e)
			END AS recType, a.A4GLIdentity
			FROM gastlmst a, gacommst b where b.gacom_com_cd = a.gastl_com_cd and a.gastl_pur_sls_ind = ''P''
		)
		select
			a.A4GLIdentity
			,a.gastl_com_cd
			,gastl_pd_yn = (case a.gastl_pd_yn when ''Y'' then ''P'' else ''U'' end)
			,a.gastl_rec_type
			,a.gastl_un_prc
			,a.gastl_cus_no
			,a.gastl_pur_sls_ind
			,a.gastl_no_un
			,a.gastl_stl_amt
			,a.gastl_un_disc_pd
			,a.gastl_un_disc_adj
			,a.gastl_un_stor_pd
			,a.gastl_ckoff_amt
			,a.gastl_ins_amt
			,a.gastl_fees_pd
			,a.gastl_un_frt_rt
			,a.gastl_loc_no
			,a.gastl_tic_no
			,a.gastl_spl_no
			,a.gastl_cnt_no
			,a.gastl_shrk_what_1
			,a.gastl_shrk_what_2
			,a.gastl_shrk_what_3
			,a.gastl_shrk_what_4
			,a.gastl_shrk_what_5
			,a.gastl_shrk_what_6
			,a.gastl_shrk_what_7
			,a.gastl_shrk_what_8
			,a.gastl_shrk_what_9
			,a.gastl_shrk_what_10
			,a.gastl_shrk_what_11
			,a.gastl_shrk_what_12
			,a.gastl_chk_no
			,a.gastl_un_disc_amt_1
			,a.gastl_un_disc_amt_2
			,a.gastl_un_disc_amt_3
			,a.gastl_un_disc_amt_4
			,a.gastl_un_disc_amt_5
			,a.gastl_un_disc_amt_6
			,a.gastl_un_disc_amt_7
			,a.gastl_un_disc_amt_8
			,a.gastl_un_disc_amt_9
			,a.gastl_un_disc_amt_10
			,a.gastl_un_disc_amt_11
			,a.gastl_un_disc_amt_12
			,a.gastl_shrk_pct_1
			,a.gastl_shrk_pct_2
			,a.gastl_shrk_pct_3
			,a.gastl_shrk_pct_4
			,a.gastl_shrk_pct_5
			,a.gastl_shrk_pct_6
			,a.gastl_shrk_pct_7
			,a.gastl_shrk_pct_8
			,a.gastl_shrk_pct_9
			,a.gastl_shrk_pct_10
			,a.gastl_shrk_pct_11
			,a.gastl_shrk_pct_12
			,gastl_stl_rev_dt = (case len(convert(varchar, a.gastl_stl_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gastl_stl_rev_dt) AS CHAR(12)), 112) else null end)
			,gastl_pmt_rev_dt = (case len(convert(varchar, a.gastl_pmt_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gastl_pmt_rev_dt) AS CHAR(12)), 112) else null end)
			,Storage = (a.gastl_no_un * a.gastl_un_stor_pd)
			,Drying = (SELECT TOP 1 drying FROM GAS where A4GLIdentity = a.A4GLIdentity)
			,Discount = (SELECT TOP 1 (case when drying <= ((a.gastl_no_un * a.gastl_un_disc_pd) + (a.gastl_no_un * a.gastl_un_disc_adj)) then ((a.gastl_no_un * a.gastl_un_disc_pd) + (a.gastl_no_un * a.gastl_un_disc_adj) + (a.gastl_no_un * a.gastl_frt_rt)) - drying else (a.gastl_no_un * a.gastl_un_disc_pd) + (a.gastl_no_un * a.gastl_un_disc_adj) + (a.gastl_no_un * a.gastl_frt_rt) end) FROM GAS where A4GLIdentity = a.A4GLIdentity)
			,Gross = a.gastl_stl_amt + (a.gastl_no_un * a.gastl_un_disc_pd) + (a.gastl_no_un * a.gastl_un_disc_adj) + (a.gastl_no_un * a.gastl_un_stor_pd) + a.gastl_ckoff_amt + a.gastl_ins_amt + a.gastl_fees_pd + (a.gastl_no_un * a.gastl_un_frt_rt)
			,Type = (SELECT TOP 1 recType FROM GAS3 where A4GLIdentity = a.A4GLIdentity)+'' ''+(SELECT TOP 1 recType FROM GAS4 where A4GLIdentity = a.A4GLIdentity)
			,Units = a.gastl_no_un
			,a.gastl_adj_ckoff_amt
			,a.gastl_frt_rt
			,a.gastl_adj_ins_amt
			,a.gastl_frt_un
			,b.gacom_ckoff_desc
			,b.gacom_ins_desc
			,'''' as TypeDetails
			,Chk_Ins = (SELECT TOP 1 chkIns FROM GAS2 where A4GLIdentity = a.A4GLIdentity)
		from
			gastlmst a
			,gacommst b
		where
			(a.gastl_pur_sls_ind = ''P'')
			and (a.gastl_com_cd = b.gacom_com_cd)

			')

GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPGAContractDetail')
	DROP VIEW vwCPGAContractDetail

-- GRAINS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPGAContractDetail]
		AS
		select
			A4GLIdentity = row_number() over (order by a.gacnt_cnt_no)
			,strCustomerNo = a.gacnt_cus_no
			,strContractNo = a.gacnt_cnt_no
			--,strSequenceNo = ''-''+convert(varchar,a.gacnt_seq_no)
			,strSequenceNo = REPLACE(STR(a.gacnt_seq_no, 2), SPACE(1), ''0'')
			,strContractType = (case a.gacnt_pur_sls_ind when ''P'' then ''Purchase Contract'' when ''S'' then ''Sales Contract'' else '''' end)
			,strLocation = a.gacnt_loc_no
			,strCommodity = b.gacom_desc
			,dtmContractDate = (case len(convert(varchar, a.gacnt_cnt_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gacnt_cnt_rev_dt) AS CHAR(12)), 112) else null end)
			,strOriginalTitle = ''Original ''+convert(varchar,b.gacom_un_desc)+'' :''
			,dblOriginalValue = a.gacnt_no_un
			,strType = (case a.gacnt_pbhcu_ind when ''B'' then ''Basis'' when ''P'' then ''Priced'' when ''H'' then ''HTA'' when ''C'' then ''CB'' when ''U'' then convert(varchar,b.gacom_desc)+'' Only'' else a.gacnt_pbhcu_ind end)
			,dtmBeginShipDate = (case len(convert(varchar, a.gacnt_beg_ship_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gacnt_beg_ship_rev_dt) AS CHAR(12)), 112) else null end)
			,strBalanceTitle = ''Balance ''+convert(varchar,b.gacom_un_desc)+'' :''
			,dblBalanceValue = a.gacnt_un_bal
			,dblCashPriced = a.gacnt_un_cash_prc
			,dtmDueDate = (case len(convert(varchar, a.gacnt_due_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gacnt_due_rev_dt) AS CHAR(12)), 112) else null end)
			,strUnpricedTitle = ''UnPriced ''+convert(varchar,b.gacom_un_desc)+'' :''
			,dblUnpricedValue = a.gacnt_un_bal_unprc
			,dblBOTPriced = a.gacnt_un_bot_prc
			,strHowShip = (case a.gacnt_trk_rail_ind when ''T'' then ''Truck'' when ''R'' then ''Rail'' when ''B'' then ''Both'' when ''D'' then ''Delivery'' when ''P'' then ''Pickup'' else '''' end)
			,strInTransitTitle = ''In-Transit ''+convert(varchar,b.gacom_un_desc)+'' :''
			,dblInTransitValue = a.gacnt_un_bal_transit
			,dblBotBasis = a.gacnt_un_bot_basis
			,strCustomerContract = a.gacnt_cus_cnt_no
			,strScheduleTitle = ''Schedule ''+convert(varchar,b.gacom_un_desc)+'' :''
			,dblScheduleValue = a.gacnt_sched_un
			,strBotOption = convert(varchar,a.gacnt_bot) +'' / ''+ convert(varchar,a.gacnt_bot_option)
			,dtmDefferPaymentDate = (case len(convert(varchar, a.gacnt_defer_pmt_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gacnt_defer_pmt_rev_dt) AS CHAR(12)), 112) else null end)
			,strBuyerName = a.gacnt_buyer
			,strDiscounts = (case a.gacnt_disc_dca_ind when ''D'' then ''Delivery'' when ''A'' then ''As-Is'' else ''Contract'' end)
			,dblDefferPaymentRate = a.gacnt_int_rt
			,strSigned = (case a.gacnt_signed_yn when ''Y'' then ''Yes'' else ''No'' end)
			,strDiscountSchedTitle = (case a.gacnt_disc_dca_ind when ''A'' then ''Discount Sched:'' else '''' end)
			,dblDiscountSchedValue = (case a.gacnt_disc_dca_ind when ''A'' then convert(varchar,a.gacnt_as_is_disc) else '''' end)
			,dblFreightRate = a.gacnt_frt_trk_rt
			,strPrinted = (case a.gacnt_printed_yn when ''Y'' then ''Yes'' else ''No'' end)
			,strMarketZone = a.gacnt_printed_yn
			,strLastContractSeq = a.gacnt_last_cnt_seq_no
			,strLastHistorySeq = a.gacnt_last_hst_seq_no
			,strRemarks = convert(varchar,a.gacnt_remarks_1)+'' ''+convert(varchar,a.gacnt_remarks_2)+'' ''+convert(varchar,a.gacnt_remarks_3)
			,a.gacnt_seq_no
			,a.gacnt_loc_no
			,a.gacnt_cnt_no
			,a.gacnt_cus_no
			,a.gacnt_com_cd
			,a.gacnt_pur_sls_ind
			,b.gacom_un_desc
			,a.gacnt_mkt_zone	
		from
			gacntmst a
			,gacommst b
		where
			a.gacnt_com_cd = b.gacom_com_cd 
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPGAContracts')
	DROP VIEW vwCPGAContracts

-- GRAINS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()	) = 1
	EXEC ('
	CREATE VIEW [dbo].[vwCPGAContracts]
	AS
	select
		a.gacnt_loc_no
		,a.gacnt_cnt_no
		,a.gacnt_seq_no
		,gacnt_due_rev_dt = (case len(convert(varchar, a.gacnt_due_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gacnt_due_rev_dt) AS CHAR(12)), 112) else null end)
		,a.gacnt_comments
		,a.gacnt_trk_rail_ind
		,a.gacnt_pbhcu_ind
		,a.gacnt_un_bot_basis
		,a.gacnt_un_cash_prc
		,a.gacnt_un_bot_prc
		,a.gacnt_com_cd
		,a.gacnt_cus_no
		,b.gacom_desc
		,a.gacnt_un_bal
		,a.gacnt_un_bal_unprc
		,status = (case when a.gacnt_un_bal > 0 then ''Open'' else ''Closed'' end)
		,a.gacnt_pur_sls_ind
		,a.gacnt_un_frt_basis
		,'''' as Remarks
		,a.gacnt_remarks_1
		,a.gacnt_remarks_2
		,a.gacnt_remarks_3
		,a.gacnt_remarks_4
		,a.gacnt_remarks_5
		,a.gacnt_remarks_6
		,a.gacnt_remarks_7
		,a.gacnt_remarks_8
		,a.gacnt_remarks_9
		,a.A4GLIdentity
	from
		gacntmst a
	left outer join
		gacommst b
		on a.gacnt_com_cd = b.gacom_com_cd
	')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPInvoicesCredits')
	DROP VIEW vwCPInvoicesCredits
GO

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPInvoicesCredits]
		AS
		select
			a.A4GLIdentity
			,a.agivc_bill_to_cus
			,a.agivc_ivc_no
			,a.agivc_loc_no
			,a.agivc_type
			,a.agivc_status
			,agivc_rev_dt = (case len(convert(varchar, a.agivc_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agivc_rev_dt) AS CHAR(12)), 112) else null end)
			,a.agivc_comment
			,a.agivc_po_no
			,a.agivc_sold_to_cus
			,a.agivc_slsmn_no
			,a.agivc_slsmn_tot
			,a.agivc_net_amt
			,a.agivc_slstx_amt
			,a.agivc_srvchr_amt
			,a.agivc_disc_amt
			,a.agivc_amt_paid
			,a.agivc_bal_due
			,a.agivc_pend_disc
			,a.agivc_no_payments
			,a.agivc_adj_inv_yn
			,a.agivc_srvchr_cd
			,agivc_disc_rev_dt = (case len(convert(varchar, a.agivc_disc_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agivc_disc_rev_dt) AS CHAR(12)), 112) else null end)
			,agivc_net_rev_dt = (case len(convert(varchar, a.agivc_net_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agivc_net_rev_dt) AS CHAR(12)), 112) else null end)
			,a.agivc_src_sys
			,agivc_orig_rev_dt = (case len(convert(varchar, a.agivc_orig_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agivc_orig_rev_dt) AS CHAR(12)), 112) else null end)
			,a.agivc_split_no
			,a.agivc_pd_days_old
			,a.agivc_eft_ivc_paid_yn
			,a.agivc_terms_code
			,b.agloc_name
			,c.agcrd_amt
			,c.agcrd_amt_used
		from agivcmst a 
			left outer join aglocmst b 
				on a.agivc_loc_no = b.agloc_loc_no 
			left outer join agcrdmst c 
				on a.agivc_bill_to_cus = c.agcrd_cus_no 
				and a.agivc_orig_rev_dt = c.agcrd_rev_dt 
				and a.agivc_ivc_no = c.agcrd_ref_no
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPInvoicesCredits]
		AS
		select ''PETRO HERE'' XX
	')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPInvoicesCreditsReports')
	DROP VIEW vwCPInvoicesCreditsReports

GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPInvoicesCreditsReports]
		AS
		select
			strCompanyName = rtrim(ltrim(c.coctl_co_name))
			,strCompanyAddress = rtrim(ltrim(c.coctl_co_addr))
			,strCompanyAddress2 = rtrim(ltrim(c.coctl_co_addr2))
			,strCompanyCityStateZip = rtrim(ltrim(c.coctl_co_city)) + '', '' + rtrim(ltrim(c.coctl_co_state)) + '' '' + rtrim(ltrim(c.coctl_co_zip))
			,strCustomerName = rtrim(ltrim(t.agcus_first_name)) + '' '' + rtrim(ltrim(t.agcus_last_name))
			,strCustomerAddress = rtrim(ltrim(t.agcus_addr))
			,strCustomerCityStateZip = rtrim(ltrim(t.agcus_city)) + '', '' + rtrim(ltrim(t.agcus_state)) + '' '' + rtrim(ltrim(t.agcus_zip))
			,strInvoiceNo = rtrim(ltrim(v.agivc_ivc_no))
			,dtmOrderDate = (case len(convert(varchar, d.agstm_ord_rev_dt)) when 8 then convert(date, cast(convert(varchar, d.agstm_ord_rev_dt) AS CHAR(12)), 112) else null end)
			,strAccountNo = rtrim(ltrim(t.agcus_key))
			,strOrderNo = rtrim(ltrim(v.agivc_ivc_no))
			,strPONo = rtrim(ltrim(v.agivc_po_no))
			,dtmShipDate = (case len(convert(varchar, d.agstm_ship_rev_dt)) when 8 then convert(date, cast(convert(varchar, d.agstm_ship_rev_dt) AS CHAR(12)), 112) else null end)
			,strTerms = rtrim(ltrim(d.agstm_terms_desc))
			,strSalesMan = rtrim(ltrim(v.agivc_slsmn_no))
			,strLocationNo = rtrim(ltrim(v.agivc_loc_no))
			,strComment = rtrim(ltrim(v.agivc_comment))
			,strItemNo = rtrim(ltrim(dd.agstm_itm_no))
			,strDescription = ''''
			,strUnitsSold = convert(nvarchar, round(dd.agstm_un, 4)) + '' '' + rtrim(ltrim(dd.agstm_un_desc))
			,dblUnitrice = round(dd.agstm_un_prc, 4)
			,dblExtended = convert(decimal(10,2),(dd.agstm_un * dd.agstm_un_prc))
			,strTax = ''GROUND WATER TAX''
			,strTaxUnitsSold = convert(nvarchar, round(dd.agstm_un, 4)) + '' '' + dd.agstm_un_desc
			,dblTaxUnitPrice = round(cast(dd.agstm_lc1_rt as float), 4)
			--,dblTaxExtended = convert(decimal(10,2), (((dd.agstm_un * dd.agstm_un_prc) * dd.agstm_lc1_rt)/100))
			,dblTaxExtended = convert(decimal(10,2), ((dd.agstm_pkg_ship * dd.agstm_un_per_pak) * dd.agstm_un_prc))
		from coctlmst c, agcusmst t, agivcmst v, agstmmst d, agstmmst dd
		where v.agivc_bill_to_cus = t.agcus_key
			and d.agstm_bill_to_cus = t.agcus_key
			and d.agstm_ivc_no = v.agivc_ivc_no
			and d.agstm_rec_type = 1
			and dd.agstm_bill_to_cus = t.agcus_key
			and dd.agstm_ivc_no = v.agivc_ivc_no
			and dd.agstm_rec_type = 5
		')
GO

-- PETRO VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPInvoicesCreditsReports]
		AS
		select ''PETRO HERE'' XX
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPOptions')
	DROP VIEW vwCPOptions

IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPOptions]
		AS
		select
			a.A4GLIdentity
			,a.gaopt_status_ind
			,a.gaopt_bot_opt
			,a.gaopt_ref_no
			,gaopt_exp_rev_dt = (case len(convert(varchar, a.gaopt_exp_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gaopt_exp_rev_dt) AS CHAR(12)), 112) else null end)
			,a.gaopt_buy_sell
			,a.gaopt_put_call
			,a.gaopt_un_prem
			,a.gaopt_un_srvc_fee
			,a.gaopt_no_un
			,a.gaopt_un_strk_prc
			,a.gaopt_com_cd
			,a.gaopt_cus_no
			,b.gacom_desc
			,b.gacom_un_desc
			,a.gaopt_prcd_no_un
			,a.gaopt_prcd_un_prc
			,a.gaopt_un_target_prc
			,a.gaopt_pur_sls_ind
		from
			gaoptmst a
		left outer join
			gacommst b
			on a.gaopt_com_cd = b.gacom_com_cd 
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPOrders')
	DROP VIEW vwCPOrders

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPOrders]
		AS
		SELECT DISTINCT
			a.A4GLIdentity
			,a.agord_ord_no
			,agord_ord_rev_dt = (case len(convert(varchar, a.agord_ord_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agord_ord_rev_dt) AS CHAR(12)), 112) else null end)
			,a.agord_type
			,a.agord_bill_to_split
			,a.agord_loc_no
			,b.agtrm_desc
			,a.agord_po_no
			,a.agord_order_total
			,a.agord_line_no
			,a.agord_bill_to_cus
			,a.agord_ship_type
			,a.agord_ship_total
			,a.agord_ivc_no
		FROM
			agordmst AS a
		INNER JOIN
			agtrmmst AS b
			ON a.agord_terms_cd = b.agtrm_key_n
		WHERE
			(a.agord_line_no = 1)
			AND (a.agord_type <> ''Q'')
		')

GO

-- PETRO VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPOrders]
		AS
		SELECT ''PETRO HERE'' XX
		')
GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPayments')
	DROP VIEW vwCPPayments

IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPayments]
		AS
		select
			p.A4GLIdentity
			,l.agloc_name
			,p.agpay_chk_no
			,p.agpay_ref_no
			,p.agpay_batch_no
			,agpay_orig_rev_dt = (case len(convert(varchar, p.agpay_orig_rev_dt)) when 8 then convert(date, cast(convert(varchar, p.agpay_orig_rev_dt) AS CHAR(12)), 112) else null end)
			,p.agpay_ivc_no
			,p.agpay_seq_no
			,p.agpay_amt
		from
			agpaymst p
			,aglocmst l
		where
		 p.agpay_loc_no = l.agloc_loc_no
		')
GO

-- PT VIEW 
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPayments]
		AS
		select ''PETRO HERE'' XX
		')
GO



IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPendingInvoices')
	DROP VIEW vwCPPendingInvoices

GO

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPendingInvoices]
		AS
		SELECT DISTINCT
			a.agord_ivc_no
			,a.agord_ord_no
			,agord_ord_rev_dt = (case len(convert(varchar, a.agord_ord_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agord_ord_rev_dt) AS CHAR(12)), 112) else null end)
			,a.agord_type
			,a.agord_bill_to_split
			,a.agord_loc_no
			,b.agtrm_desc
			,a.agord_po_no
			,a.agord_order_total
			,a.agord_line_no
			,a.agord_bill_to_cus
			,a.agord_ship_type
			,a.agord_ship_total
			,a.A4GLIdentity
		FROM
			agordmst AS a
		INNER JOIN
			agtrmmst AS b 
			ON
				a.agord_terms_cd = b.agtrm_key_n
		WHERE
			(a.agord_line_no = 1)
			AND (a.agord_type IN (''I'', ''B'', ''D'', ''C'', ''O''))
			AND (a.agord_ship_total <> 0)
		')
GO

-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPendingInvoices]
		AS
		SELECT ''PETRO HERE'' XX
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPendingPayments')
	DROP VIEW vwCPPendingPayments
GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPendingPayments]
		AS
		select
			a.agpye_chk_no
			,agpye_rev_dt = (case len(convert(varchar, a.agpye_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agpye_rev_dt) AS CHAR(12)), 112) else null end)
			,agpye_amt = sum(a.agpye_amt)
			,b.agivc_bill_to_cus
			,A4GLIdentity = row_number() over (order by a.agpye_chk_no)
		from agpyemst a
		left outer join agivcmst b
			on a.agpye_cus_no = b.agivc_bill_to_cus
			and a.agpye_inc_ref = b.agivc_ivc_no
			and a.agpye_ivc_loc_no = b.agivc_loc_no 
		group by 
			a.agpye_chk_no
			,agpye_rev_dt
			,b.agivc_bill_to_cus

		')

GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPendingPayments]
		AS
		select ''PETRO HERE'' XX
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPrepaidCredits')
	DROP VIEW vwCPPrepaidCredits
GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPrepaidCredits]
		AS
		select 
			A4GLIdentity = row_number() over (order by agcrd_loc_no)
			,agcrd_cus_no
			,agcrd_loc_no
			,agcrd_cred_ind
			,agcrd_ref_no
			,agcrd_rev_dt = (case len(convert(varchar, agcrd_rev_dt)) when 8 then convert(date, cast(convert(varchar, agcrd_rev_dt) AS CHAR(12)), 112) else null end)
			,sum(agcrd_amt - agcrd_amt_used) as agcrd_amt
		from agcrdmst
		where
			(agcrd_cred_ind = ''P'')
			and (agcrd_amt - agcrd_amt_used <> 0)
		group by
			agcrd_cus_no
			,agcrd_loc_no
			,agcrd_cred_ind
			,agcrd_ref_no
			,agcrd_rev_dt
		')
GO

-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPrepaidCredits]
		AS
		select ''PETRO HERE'' XX
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPProductionHistory')
	DROP VIEW vwCPProductionHistory
GO
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPProductionHistory]
		AS
		select
			a.A4GLIdentity
			,b.ssspl_desc
			,b.ssspl_rec_type
			,a.gaphs_spl_no
			,gaphs_dlvry_rev_dt = (case len(convert(varchar, a.gaphs_dlvry_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.gaphs_dlvry_rev_dt) AS CHAR(12)), 112) else null end)
			,a.gaphs_loc_no
			,a.gaphs_tic_no
			,a.gaphs_gross_un
			,a.gaphs_wet_un
			,a.gaphs_net_un
			,a.gaphs_cus_no
			,a.gaphs_com_cd
			,c.gacom_desc
			,c.gacom_un_desc
			,a.gaphs_fees
			,a.gaphs_gross_wgt
			,a.gaphs_tare_wgt
			,a.gaphs_cus_ref_no
			,a.gaphs_pur_sls_ind
		from
			gacommst c
			,gaphsmst a
		left outer join
			sssplmst b 
			on a.gaphs_cus_no = b.ssspl_bill_to_cus
			and a.gaphs_spl_no = b.ssspl_split_no
			and b.ssspl_rec_type in (''G'', ''B'') 
		where
			(c.gacom_com_cd = a.gaphs_com_cd)
	')
GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPurchaseDetail')
	DROP VIEW vwCPPurchaseDetail
GO

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPurchaseDetail]
		AS
		select distinct
			a.A4GLIdentity
			,a.agstm_bill_to_cus
			,a.agstm_itm_no
			,a.agstm_loc_no
			,a.agstm_ivc_no
			,agstm_ship_rev_dt = (case len(convert(varchar, a.agstm_ship_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agstm_ship_rev_dt) AS CHAR(12)), 112) else null end)
			,b.agitm_desc
			,a.agstm_un
			,a.agstm_un_desc
			,a.agstm_un_prc * (a.agstm_pkg_ship * a.agstm_un_per_pak) as agstm_amount
		from
			agstmmst a
			,agitmmst b
		where
			a.agstm_itm_no = b.agitm_no
			and (a.agstm_rec_type = 5)
		')
GO

-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPurchaseDetail]
		AS
		select ''PETRO HERE'' XX
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPurchaseMain')
	DROP VIEW vwCPPurchaseMain
GO
CREATE VIEW [dbo].[vwCPPurchaseMain]
AS

select distinct
	 id = row_number() over (order by agstm_bill_to_cus)
	,strCustomerNo = agstm_bill_to_cus
	,strItemNo = agstm_itm_no
	,strLocationNo = agstm_loc_no
	,strDescription = agitm_desc
	,intUnit = agstm_un
	,strUnitDescription = agstm_un_desc
	,dblAmount = sum(agstm_amount)
from
	vwCPPurchaseDetail
group by
	agstm_bill_to_cus
	,agstm_itm_no
	,agstm_loc_no
	,agitm_desc
	,agstm_un
	,agstm_un_desc

GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPurchases')
	DROP VIEW vwCPPurchases
GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPurchases]
		AS
		select
			a.A4GLIdentity
			,a.agstm_bill_to_cus
			,a.agstm_itm_no
			,a.agstm_sls
			,a.agstm_un
			,a.agstm_un_desc
			,a.agstm_loc_no
			,agstm_ship_rev_dt = (case len(convert(varchar, a.agstm_ship_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agstm_ship_rev_dt) AS CHAR(12)), 112) else null end)
			,a.agstm_un_prc * (a.agstm_un_per_pak * a.agstm_pkg_ship) as agstm_un_prc
			,a.agstm_ivc_no
			,b.agitm_desc
		from
			agstmmst a
		left outer join
			agitmmst b
			on
				a.agstm_loc_no = b.agitm_loc_no
				and a.agstm_itm_no = b.agitm_no 
		where
			(a.agstm_rec_type = 5)
		')

GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPurchases]
		AS
		select ''PETRO HERE'' XX
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPPurchasesDetail')
	DROP VIEW vwCPPurchasesDetail

GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPurchasesDetail]
		AS
		select
			a.A4GLIdentity
			,a.agstm_bill_to_cus
			,a.agstm_itm_no
			,a.agstm_sls
			,a.agstm_un
			,a.agstm_un_desc
			,a.agstm_loc_no
			,agstm_ship_rev_dt = (case len(convert(varchar, a.agstm_ship_rev_dt)) when 8 then convert(date, cast(convert(varchar, a.agstm_ship_rev_dt) AS CHAR(12)), 112) else null end)
			,a.agstm_un_prc * (a.agstm_un_per_pak * a.agstm_pkg_ship) as agstm_un_prc
			,a.agstm_ivc_no
			,b.agitm_desc
		from
			agstmmst a
		left outer join
			agitmmst b
			on
				a.agstm_loc_no = b.agitm_loc_no
				and a.agstm_itm_no = b.agitm_no 
		where
			(a.agstm_rec_type = 5)
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPPurchasesDetail]
		AS
		select ''PETRO here'' XX
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPSettlements')
	DROP VIEW vwCPSettlements
GO
-- GRAINS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPSettlements]
		AS
		select
			gastl_rec_type
			,gastl_no_un
			,gastl_stl_amt
			,gastl_loc_no
			,gastl_stl_rev_dt = (case len(convert(varchar, gastl_stl_rev_dt)) when 8 then convert(date, cast(convert(varchar, gastl_stl_rev_dt) AS CHAR(12)), 112) else null end)
			,gastl_tic_no
			,gastl_spl_no
			,gastl_ivc_no
			,gastl_defer_pmt_rev_dt = (case len(convert(varchar, gastl_defer_pmt_rev_dt)) when 8 then convert(date, cast(convert(varchar, gastl_defer_pmt_rev_dt) AS CHAR(12)), 112) else null end)
			,gastl_cnt_no
			,gastl_pd_yn = (case gastl_pd_yn when ''Y'' then ''P'' else ''U'' end)
			,gastl_cus_no
			,gastl_com_cd
			,gastl_tie_breaker
			,gastl_chk_no
			,gastl_un_prc
			,gastl_pur_sls_ind
			,gastl_pmt_rev_dt = (case len(convert(varchar, gastl_pmt_rev_dt)) when 8 then convert(date, cast(convert(varchar, gastl_pmt_rev_dt) AS CHAR(12)), 112) else null end)
			,A4GLIdentity
		from
			gastlmst
		where
			(gastl_rec_type <> ''F'')
		')
GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwCPStorage')
	DROP VIEW vwCPStorage

-- GRAINS DEPENDENT
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'GR' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwCPStorage]
		AS
		select
			gastr_stor_type
			,gastr_loc_no
			,gastr_dlvry_rev_dt = (case len(convert(varchar, gastr_dlvry_rev_dt)) when 8 then convert(date, cast(convert(varchar, gastr_dlvry_rev_dt) AS CHAR(12)), 112) else null end)
			,gastr_tic_no
			,gastr_spl_no
			,gastr_dpa_or_rcpt_no
			,gastr_un_disc_due
			,gastr_un_disc_pd
			,gastr_un_stor_due
			,gastr_stor_schd_no
			,gastr_un_bal
			,gastr_cus_no
			,gastr_com_cd
			,gastr_tie_breaker
			,gastr_un_stor_pd
			,gastr_pur_sls_ind
			,A4GLIdentity
		from
			gastrmst
		where
			(gastr_un_bal > 0)
		')

-- TANK MANAGEMENT
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwctlmst')
	DROP VIEW vwctlmst
GO

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwctlmst]
		AS
		SELECT
		A4GLIdentity		=CAST(A4GLIdentity   AS INT)
		,vwctl_key			=CAST (agctl_key AS INT)
		,vwcar_per1_desc	=CAST(agcar_per1_desc AS CHAR(20))
		,vwcar_per2_desc	=CAST(agcar_per2_desc AS CHAR(20))
		,vwcar_per3_desc	=CAST(agcar_per3_desc AS CHAR(20))
		,vwcar_per4_desc	=CAST(agcar_per4_desc AS CHAR(20))
		,vwcar_per5_desc	=CAST(agcar_per5_desc AS CHAR(20))
		,vwcar_future_desc	=agcar_future_desc	
		,vwctl_sa_cost_ind	=agctl_sa_cost_ind
		,vwctl_stmt_close_rev_dt =(SELECT agctl_stmt_close_rev_dt FROM agctlmst WHERE agctl_key=1)
		FROM agctlmst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwctlmst]
		AS
		SELECT
			A4GLIdentity		=CAST(A4GLIdentity   AS INT)
			,vwctl_key			=CAST(ptctl_key AS INT)
			,vwcar_per1_desc	=CAST(pt4cf_per_desc_1 AS CHAR(20))
			,vwcar_per2_desc	=CAST(pt4cf_per_desc_2 AS CHAR(20)) 
			,vwcar_per3_desc	=CAST(pt4cf_per_desc_3 AS CHAR(20))
			,vwcar_per4_desc	=CAST(pt4cf_per_desc_4 AS CHAR(20))
			,vwcar_per5_desc	=CAST(pt4cf_per_desc_5 AS CHAR(20))  
			,vwcar_future_desc	=CAST(NULL AS CHAR(12)) 	
			,vwctl_sa_cost_ind	=CAST(pt4cf_per_desc_1 AS CHAR(1))
			,vwctl_stmt_close_rev_dt =pt3cf_eom_business_rev_dt
			FROM ptctlmst
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwcusmst')
	DROP VIEW vwcusmst
GO

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwcusmst]  
		AS  
		SELECT  
		vwcus_key    = agcus_key    
		,vwcus_last_name =			(CASE WHEN (agcus_co_per_ind_cp = ''P'') 
											THEN RTRIM(CAST(agcus_last_name AS CHAR(25))) 
											ELSE 
												CAST(agcus_last_name AS CHAR(25))  + CAST(agcus_first_name AS CHAR(25))
											END)
		,vwcus_first_name =			(CASE WHEN (agcus_co_per_ind_cp = ''P'') 
											THEN RTRIM(CAST(ISNULL(agcus_first_name,'''') AS CHAR(25))) 
											ELSE 
												CAST('''' AS CHAR(25))
											END)   
		,vwcus_mid_init = CAST('''' AS CHAR(1))
		,vwcus_name_suffix = CAST('''' AS CHAR(2))
		,vwcus_addr    = agcus_addr    
		,vwcus_addr2   = agcus_addr2    
		,vwcus_city    = agcus_city    
		,vwcus_state   = agcus_state    
		,vwcus_zip    = agcus_zip    
		,vwcus_phone   = agcus_phone    
		,vwcus_phone_ext  = agcus_phone_ext    
		,vwcus_bill_to   = agcus_bill_to    
		,vwcus_contact   = agcus_contact    
		,vwcus_comments   = agcus_comments    
		,vwcus_slsmn_id   = agcus_slsmn_id    
		,vwcus_terms_cd   = CAST(agcus_terms_cd AS INT)    
		,vwcus_prc_lvl   = agcus_prc_lvl    
		,vwcus_stmt_fmt   = agcus_stmt_fmt    
		,vwcus_ytd_pur   = agcus_ytd_pur    
		,vwcus_ytd_sls   = agcus_ytd_sls    
		,vwcus_ytd_cgs   = agcus_ytd_cgs    
		,vwcus_budget_amt  = agcus_budget_amt    
		,vwcus_budget_beg_mm = agcus_budget_beg_mm    
		,vwcus_budget_end_mm = agcus_budget_end_mm    
		,vwcus_active_yn  = agcus_active_yn    
		,vwcus_ar_future  = agcus_ar_future    
		,vwcus_ar_per1   = agcus_ar_per1    
		,vwcus_ar_per2   = agcus_ar_per2    
		,vwcus_ar_per3   = agcus_ar_per3    
		,vwcus_ar_per4   = agcus_ar_per4    
		,vwcus_ar_per5   = agcus_ar_per5    
		,vwcus_pend_ivc   = agcus_pend_ivc    
		,vwcus_cred_reg   = agcus_cred_reg    
		,vwcus_pend_pymt  = agcus_pend_pymt    
		,vwcus_cred_ga   = agcus_cred_ga    
		,vwcus_co_per_ind_cp = CAST(agcus_co_per_ind_cp AS CHAR(4))  
		,vwcus_bus_loc_no  = agcus_bus_loc_no   
		,vwcus_cred_limit  = agcus_cred_limit  
		,vwcus_last_stmt_bal = agcus_last_stmt_bal  
		,vwcus_budget_amt_due = CAST(agcus_budget_amt_due AS DECIMAL(18,6))  
		,vwcus_cred_ppd   = agcus_cred_ppd  
		,vwcus_ytd_srvchr  = CAST(agcus_ytd_srvchr AS DECIMAL(18,6))  
		,vwcus_last_pymt  = agcus_last_pymt  
		,vwcus_last_pay_rev_dt = agcus_last_pay_rev_dt  
		,vwcus_last_ivc_rev_dt = agcus_last_ivc_rev_dt  
		,vwcus_high_cred  = agcus_high_cred   
		,vwcus_high_past_due = agcus_high_past_due  
		,vwcus_avg_days_pay  = agcus_avg_days_pay  
		,vwcus_avg_days_no_ivcs = agcus_avg_days_no_ivcs  
		,vwcus_last_stmt_rev_dt = agcus_last_stmt_rev_dt  
		,vwcus_country   = agcus_country  
		,vwcus_termdescription  = (select top 1 agtrm_desc from agtrmmst where agtrm_key_n = agcus_terms_cd)  
		,vwcus_tax_ynp   = agcus_tax_ynp  
		,vwcus_tax_state  = agcus_tax_state  
		,A4GLIdentity= CAST(A4GLIdentity as INT)  
		,vwcus_phone2   =agcus_phone2  
		,vwcus_balance = agcus_ar_future + agcus_ar_per1 + agcus_ar_per2 + agcus_ar_per3 + agcus_ar_per4 + agcus_ar_per5 - agcus_cred_reg - agcus_cred_ga  
		,vwcus_ptd_sls = agcus_ptd_sls   
		,vwcus_lyr_sls = agcus_lyr_sls
		FROM agcusmst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwcusmst]  
		AS  
		SELECT  
		vwcus_key    = ptcus_cus_no    
		,vwcus_last_name =			(CASE WHEN (ptcus_co_per_ind_cp = ''P'') 
											THEN RTRIM(CAST(ptcus_last_name AS CHAR(25))) 
											ELSE 
													CAST(ptcus_last_name AS CHAR(15))  
													+ CAST(ptcus_first_name AS CHAR(12)) 
													+ CAST(ISNULL(ptcus_mid_init,'''') AS CHAR(1)) 
													+ CAST(ISNULL(ptcus_name_suffx,'''') AS CHAR(2))
											END)
		,vwcus_first_name =			(CASE WHEN (ptcus_co_per_ind_cp = ''P'') 
											THEN RTRIM(CAST(ISNULL(ptcus_first_name,'''') AS CHAR(25))) 
											ELSE 
												CAST('''' AS CHAR(25))
											END)   
		,vwcus_mid_init = (CASE WHEN (ptcus_co_per_ind_cp = ''P'') 
											THEN RTRIM(CAST(ISNULL(ptcus_mid_init,'''') AS CHAR(1))) 
											ELSE 
												CAST('''' AS CHAR(1))
											END)
		,vwcus_name_suffix = (CASE WHEN (ptcus_co_per_ind_cp = ''P'') 
											THEN RTRIM(CAST(ISNULL(ptcus_name_suffx,'''') AS CHAR(2))) 
											ELSE 
												CAST('''' AS CHAR(2))
											END)
		,vwcus_addr    = ptcus_addr    
		,vwcus_addr2   = ISNULL(CAST(RTRIM(ptcus_addr2) AS CHAR(30)),'''')    
		,vwcus_city    = ptcus_city    
		,vwcus_state   = ptcus_state   
		,vwcus_zip    = CAST(ptcus_zip AS CHAR(10))    
		,vwcus_phone   = CAST(ptcus_phone AS CHAR(15))    
		,vwcus_phone_ext  = ptcus_phone_ext    
		,vwcus_bill_to   = ptcus_bill_to    
		,vwcus_contact   = ptcus_contact    
		,vwcus_comments   = CAST(ptcus_comment AS CHAR(30))    
		,vwcus_slsmn_id   = ptcus_slsmn_id    
		,vwcus_terms_cd   = CAST(ptcus_terms_code AS INT)
		,vwcus_prc_lvl   = CAST(ptcus_prc_level AS TINYINT)    
		,vwcus_stmt_fmt   = ptcus_stmt_fmt    
		,vwcus_ytd_pur   = CAST(ptcus_purchs_ytd AS INT)    
		,vwcus_ytd_sls   = ptcus_ytd_sales    
		,vwcus_ytd_cgs   = ptcus_ytd_cgs    
		,vwcus_budget_amt  = CAST(ptcus_budget_amt AS DECIMAL(9))    
		,vwcus_budget_beg_mm = ptcus_budget_beg_mm    
		,vwcus_budget_end_mm = ptcus_budget_end_mm    
		,vwcus_active_yn  = ptcus_active_yn    
		,vwcus_ar_future  = ptcus_ar_curr    
		,vwcus_ar_per1   = ptcus_ar_3160    
		,vwcus_ar_per2   = ptcus_ar_6190    
		,vwcus_ar_per3   = ptcus_ar_91120    
		,vwcus_ar_per4   = ptcus_ar_ov120    
		,vwcus_ar_per5   = CAST(0 AS DECIMAL(18,6))    
		,vwcus_pend_ivc   = ISNULL((SELECT SUM(
									CASE WHEN vwpye_amt IS NULL THEN 0.00 ELSE vwpye_amt END
										) FROM vwpyemst WHERE vwpye_cus_no = ptcus_cus_no ),0.00)    
		,vwcus_cred_reg   = ptcus_cred_reg    
		,vwcus_pend_pymt  = ISNULL((SELECT SUM(
									CASE vwtic_type
										WHEN ''I'' THEN CASE WHEN vwtic_ship_total IS NULL THEN 0 ELSE vwtic_ship_total END 
										WHEN ''C'' THEN CASE WHEN vwtic_ship_total IS NULL THEN -0 ELSE 0-vwtic_ship_total END  
										WHEN ''S'' THEN CASE WHEN vwtic_ship_total IS NULL THEN 0 ELSE vwtic_ship_total END  
										WHEN ''R'' THEN CASE WHEN vwtic_ship_total IS NULL THEN -0 ELSE 0-vwtic_ship_total END  
										WHEN ''D'' THEN CASE WHEN vwtic_ship_total IS NULL THEN 0 ELSE vwtic_ship_total END 
										WHEN ''O'' THEN CASE WHEN vwtic_ship_total IS NULL THEN 0 ELSE vwtic_ship_total END 
										WHEN ''B'' THEN CASE WHEN vwtic_ship_total IS NULL THEN 0 ELSE vwtic_ship_total END 
										ELSE vwtic_ship_total
									END
								)		
							FROM vwticmst WHERE vwtic_cus_no = ptcus_cus_no ),0.00)    
		,vwcus_cred_ga   = CAST(0 AS DECIMAL(18,6))    
		,vwcus_co_per_ind_cp = CAST(ptcus_co_per_ind_cp AS CHAR(4))  
		,vwcus_bus_loc_no  = ptcus_bus_loc_no   
		,vwcus_cred_limit  = CAST(ptcus_credit_limit AS INT)  
		,vwcus_last_stmt_bal = ptcus_last_stmnt_bal  
		,vwcus_budget_amt_due = CAST(0 AS DECIMAL(18,6)) 
		,vwcus_cred_ppd   = ptcus_cred_ppd  
		,vwcus_ytd_srvchr  = CAST(0 AS DECIMAL(18,6))
		,vwcus_last_pymt  = ptcus_last_pay_amt  
		,vwcus_last_pay_rev_dt = ptcus_last_pay_rev_dt  
		,vwcus_last_ivc_rev_dt = ptcus_last_ivc_rev_dt  
		,vwcus_high_cred  = CAST(0 AS DECIMAL(18,6))   
		,vwcus_high_past_due = CAST(0 AS DECIMAL(18,6))  
		,vwcus_avg_days_pay  = CAST(0 AS SMALLINT) 
		,vwcus_avg_days_no_ivcs = CAST(0 AS SMALLINT)  
		,vwcus_last_stmt_rev_dt = ptcus_last_stmnt_rev_dt  
		,vwcus_country   = CAST('''' as char(3))  
		,vwcus_termdescription  = (select top 1 pttrm_desc from pttrmmst where pttrm_code = ptcus_terms_code)
		,vwcus_tax_ynp   = CAST('''' as char(1))  
		,vwcus_tax_state  = CAST('''' as char(2))  
		,A4GLIdentity= CAST(A4GLIdentity as INT)  
		,vwcus_phone2   =ptcus_phone2  
		,vwcus_balance = ptcus_ar_curr + ptcus_ar_3160 + ptcus_ar_6190 + ptcus_ar_91120 + ptcus_ar_ov120 -ptcus_cred_reg - ptcus_cred_ppd 
		,vwcus_ptd_sls = ptcus_ptd_sales   
		,vwcus_lyr_sls = CAST(0 AS DECIMAL)
		FROM ptcusmst
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwitmmst')
	DROP VIEW vwitmmst

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwitmmst]  
		AS  
		SELECT  
		vwitm_no = agitm_no  
		,vwitm_loc_no = agitm_loc_no  
		,vwitm_class = agitm_class  
		,vwitm_search = agitm_search  
		,vwitm_desc = agitm_desc  
		,vwitm_un_desc = CAST(agitm_un_desc AS CHAR(10))  
		,vwitm_un_prc1 = agitm_un_prc1  
		,vwitm_un_prc2 = agitm_un_prc2  
		,vwitm_un_prc3 = agitm_un_prc3  
		,vwitm_un_prc4 = agitm_un_prc4  
		,vwitm_un_prc5 = agitm_un_prc5  
		,vwitm_un_prc6 = agitm_un_prc6  
		,vwitm_un_prc7 = agitm_un_prc7  
		,vwitm_un_prc8 = agitm_un_prc8  
		,vwitm_un_prc9 = agitm_un_prc9  
		,vwitm_ytd_ivc_cost = agitm_ytd_ivc_cost  
		,A4GLIdentity  = CAST(A4GLIdentity   AS INT)  
		,vwitm_avail_tm = CAST(agitm_avail_tm AS CHAR(10))  
		,vwitm_phys_inv_ynbo = CAST(agitm_phys_inv_ynbo AS CHAR(10)) 
		,vwitm_deflt_percnt = CAST(ISNULL(agitm_deflt_percnt,0) AS INT)  
		,vwitm_slstax_rpt_ynha = agitm_slstax_rpt_ynha  
		,vwitm_last_un_cost = agitm_last_un_cost  
		,vwitm_avg_un_cost    = agitm_avg_un_cost  
		,vwitm_std_un_cost    = agitm_std_un_cost  
		FROM agitmmst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwitmmst]  
		AS  
		SELECT  
		vwitm_no = CAST(ptitm_itm_no AS CHAR(13))    
		,vwitm_loc_no = ptitm_loc_no  
		,vwitm_class = ptitm_class  
		,vwitm_search = CAST(''''  AS CHAR(13))    
		,vwitm_desc = CAST(ptitm_desc AS CHAR(33))   
		,vwitm_un_desc = CAST(''''  AS CHAR(10))  
		,vwitm_un_prc1 = CAST(ptitm_prc1  AS DECIMAL(18,6))    
		,vwitm_un_prc2 = CAST(ptitm_prc2  AS DECIMAL(18,6))   
		,vwitm_un_prc3 = CAST(ptitm_prc3  AS DECIMAL(18,6))    
		,vwitm_un_prc4 = CAST(0.00  AS DECIMAL(18,6))    
		,vwitm_un_prc5 = CAST(0.00  AS DECIMAL(18,6))    
		,vwitm_un_prc6 = CAST(0.00  AS DECIMAL(18,6))    
		,vwitm_un_prc7 = CAST(0.00  AS DECIMAL(18,6))    
		,vwitm_un_prc8 = CAST(0.00  AS DECIMAL(18,6))    
		,vwitm_un_prc9 = CAST(0.00  AS DECIMAL(18,6))    
		,vwitm_ytd_ivc_cost = CAST(0.00  AS DECIMAL(18,6))    
		,A4GLIdentity  = CAST(A4GLIdentity   AS INT)  
		,vwitm_avail_tm = CAST(''Y''  AS CHAR(10)) 
		,vwitm_phys_inv_ynbo = CAST(ptitm_phys_inv_yno AS CHAR(10)) 
		,vwitm_deflt_percnt = CAST(ptitm_deflt_percnt  AS INT)
		,vwitm_slstax_rpt_ynha = ptitm_sst_yn  
		,vwitm_last_un_cost = CAST(0.00  AS DECIMAL(18,6))    
		,vwitm_avg_un_cost    = ptitm_avg_cost  
		,vwitm_std_un_cost    = ptitm_std_cost  
		FROM ptitmmst
		')
GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwivcmst')
	DROP VIEW vwivcmst

GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwivcmst]
		AS
		SELECT
		vwivc_bill_to_cus		=	agivc_bill_to_cus
		,vwivc_ivc_no			=	agivc_ivc_no
		,vwivc_loc_no			=	agivc_loc_no
		,vwivc_type				=	CAST(agivc_type AS CHAR(4))
		,vwivc_status			=	CAST(agivc_status AS CHAR(3))
		,vwivc_rev_dt			=	agivc_rev_dt
		,vwivc_comment			=	agivc_comment
		,vwivc_po_no			=	agivc_po_no
		,vwivc_sold_to_cus		=	agivc_sold_to_cus
		,vwivc_slsmn_no			=	CAST(agivc_slsmn_no AS CHAR(4))
		,vwivc_slsmn_tot		=	agivc_slsmn_tot
		,vwivc_net_amt			=	agivc_net_amt
		,vwivc_slstx_amt		=	CAST(agivc_slstx_amt AS DECIMAL(18,6))
		,vwivc_srvchr_amt		=	agivc_srvchr_amt
		,vwivc_disc_amt			=	CAST(agivc_disc_amt AS DECIMAL(18,6))
		,vwivc_amt_paid			=	agivc_amt_paid
		,vwivc_bal_due			=	agivc_bal_due
		,vwivc_pend_disc		=	CAST(agivc_pend_disc AS DECIMAL(18,6))
		,vwivc_no_payments		=	CAST(agivc_no_payments AS INT)
		,vwivc_adj_inv_yn		=	agivc_adj_inv_yn
		,vwivc_srvchr_cd		=	CAST(agivc_srvchr_cd AS INT)
		,vwivc_disc_rev_dt		=	agivc_disc_rev_dt
		,vwivc_net_rev_dt		=	agivc_net_rev_dt
		,vwivc_src_sys			=	CAST(agivc_src_sys AS CHAR(4))
		,vwivc_orig_rev_dt		=	agivc_orig_rev_dt
		,vwivc_split_no			=	agivc_split_no
		,vwivc_pd_days_old		=	CAST(agivc_pd_days_old AS INT)
		,vwivc_currency			=	CAST(agivc_currency AS CHAR(4))
		,vwivc_currency_rt		=	agivc_currency_rt
		,vwivc_currency_cnt		=	agivc_currency_cnt
		,vwivc_eft_ivc_paid_yn	=	agivc_eft_ivc_paid_yn
		,vwivc_terms_code		=	CAST(agivc_terms_code AS CHAR(4))
		,vwivc_pay_type			=	CAST(agivc_pay_type AS CHAR(4))
		,vwivc_user_id			=	agivc_user_id
		,vwivc_user_rev_dt		=	agivc_user_rev_dt
		,A4GLIdentity			=	CAST(A4GLIdentity   AS INT)
		FROM agivcmst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwivcmst]
		AS
		SELECT
		vwivc_bill_to_cus		=	ptivc_cus_no
		,vwivc_ivc_no			=	CAST(ptivc_invc_no AS CHAR(8))  
		,vwivc_loc_no			=	ptivc_loc_no
		,vwivc_type				=	CAST(NULL AS CHAR(4))  
		,vwivc_status			=	CAST(ptivc_sold_by AS CHAR(3))  
		,vwivc_rev_dt			=	NULL
		,vwivc_comment			=	ptivc_comment  
		,vwivc_po_no			=	ptivc_po_no
		,vwivc_sold_to_cus		=	ptivc_sold_to
		,vwivc_slsmn_no			=	CAST(NULL AS CHAR(4))  
		,vwivc_slsmn_tot		=	ptivc_sold_by_tot
		,vwivc_net_amt			=	ptivc_net
		,vwivc_slstx_amt		=	CAST(ptivc_sales_tax AS DECIMAL(18,6)) 
		,vwivc_srvchr_amt		=	CAST(0.00 AS DECIMAL(18,6))  
		,vwivc_disc_amt			=	CAST(ptivc_disc_amt AS DECIMAL(18,6))  
		,vwivc_amt_paid			=	ptivc_amt_applied
		,vwivc_bal_due			=	ptivc_bal_due
		,vwivc_pend_disc		=	CAST(ptivc_pend_disc AS DECIMAL(18,6)) 
		,vwivc_no_payments		=	CAST(ptivc_no_payments AS INT)
		,vwivc_adj_inv_yn		=	ptivc_adj_inv_yn
		,vwivc_srvchr_cd		=	CAST(0 AS INT)  
		,vwivc_disc_rev_dt		=	NULL
		,vwivc_net_rev_dt		=	NULL
		,vwivc_src_sys			=	CAST(NULL AS CHAR(4))  
		,vwivc_orig_rev_dt		=	NULL
		,vwivc_split_no			=	CAST(NULL AS CHAR(4))  
		,vwivc_pd_days_old		=	CAST(0 AS INT) 
		,vwivc_currency			=	CAST(NULL AS CHAR(4)) 
		,vwivc_currency_rt		=	CAST(0.00 AS DECIMAL(18,6))
		,vwivc_currency_cnt		=	CAST(NULL AS CHAR(8))  
		,vwivc_eft_ivc_paid_yn	=	ptivc_eft_ivc_paid_yn 
		,vwivc_terms_code		=	CAST(NULL AS CHAR(4)) 
		,vwivc_pay_type			=	CAST(NULL AS CHAR(4)) 
		,vwivc_user_id			=	CAST(NULL AS CHAR(16))  
		,vwivc_user_rev_dt		=	NULL
		,A4GLIdentity			=	CAST(A4GLIdentity   AS INT)
		FROM ptivcmst
		')

GO


IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwlclmst')
	DROP VIEW vwlclmst

GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwlclmst]
		AS
		SELECT
		vwlcl_tax_state	=	aglcl_tax_state,
		vwlcl_tax_auth_id1	=	aglcl_tax_auth_id1,
		vwlcl_tax_auth_id2	=	aglcl_tax_auth_id2,
		vwlcl_auth_id1_desc	=	aglcl_auth_id1_desc,
		vwlcl_auth_id2_desc	=	aglcl_auth_id2_desc,
		vwlcl_fet_ivc_desc	=	aglcl_fet_ivc_desc,
		vwlcl_set_ivc_desc	=	aglcl_set_ivc_desc,
		vwlcl_lc1_ivc_desc	=	aglcl_lc1_ivc_desc,
		vwlcl_lc2_ivc_desc	=	aglcl_lc2_ivc_desc,
		vwlcl_lc3_ivc_desc	=	aglcl_lc3_ivc_desc,
		vwlcl_lc4_ivc_desc	=	aglcl_lc4_ivc_desc,
		vwlcl_lc5_ivc_desc	=	aglcl_lc5_ivc_desc
		,vwlcl_lc6_ivc_desc	=	aglcl_lc6_ivc_desc
		,vwlcl_user_id	=	aglcl_user_id
		,vwlcl_user_rev_dt	=	aglcl_user_rev_dt
		,A4GLIdentity	=	CAST(A4GLIdentity   AS INT)
		FROM aglclmst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwlclmst]
		AS
		SELECT
		vwlcl_tax_state	=	ptlcl_state,
		vwlcl_tax_auth_id1	=	ptlcl_local1_id,
		vwlcl_tax_auth_id2	=	ptlcl_local2_id,
		vwlcl_auth_id1_desc	=	ptlcl_desc,
		vwlcl_auth_id2_desc	=	CAST(NULL AS CHAR(30)),
		vwlcl_fet_ivc_desc	=	CAST(NULL AS CHAR(20)),  
		vwlcl_set_ivc_desc	=	CAST(NULL AS CHAR(20)),
		vwlcl_lc1_ivc_desc	=	ptlcl_local1_desc,
		vwlcl_lc2_ivc_desc	=	ptlcl_local2_desc,
		vwlcl_lc3_ivc_desc	=	ptlcl_local3_desc,
		vwlcl_lc4_ivc_desc	=	ptlcl_local4_desc,
		vwlcl_lc5_ivc_desc	=	ptlcl_local5_desc
		,vwlcl_lc6_ivc_desc	=	ptlcl_local6_desc
		,vwlcl_user_id	=	CAST(NULL AS CHAR(16))
		,vwlcl_user_rev_dt	=	NULL
		,A4GLIdentity	=	CAST(A4GLIdentity   AS INT)
		FROM ptlclmst
		')

GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwlocmst')
	DROP VIEW vwlocmst
GO

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwlocmst]
		AS
		SELECT
			agloc_loc_no	COLLATE Latin1_General_CI_AS as vwloc_loc_no,
			agloc_name		COLLATE Latin1_General_CI_AS as vwloc_name,
			agloc_addr		COLLATE Latin1_General_CI_AS as vwloc_addr,
			CAST(A4GLIdentity AS INT) as A4GLIdentity	
		FROM aglocmst
		')
		
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwlocmst]
		AS
		SELECT
			ptloc_loc_no	COLLATE Latin1_General_CI_AS as vwloc_loc_no,
			ptloc_name		COLLATE Latin1_General_CI_AS as vwloc_name,
			ptloc_addr		COLLATE Latin1_General_CI_AS as vwloc_addr,
			CAST(A4GLIdentity AS INT) as A4GLIdentity	
		FROM ptlocmst
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwprcmst')
	DROP VIEW vwprcmst

GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()) = 1
	IF (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'ASP' and strDBName = db_name()) = 1
		EXEC ('
			CREATE VIEW [dbo].[vwprcmst]  
			AS  
			SELECT  
			vwprc_cus_no   = spprc_cus_no     
			,vwprc_itm_no   = spprc_itm_no     
			,vwprc_class    = spprc_class      
			,vwprc_basis_ind   = spprc_basis_ind     
			,vwprc_begin_rev_dt  = spprc_begin_rev_dt    
			,vwprc_end_rev_dt  = spprc_end_rev_dt    
			,vwprc_factor   = spprc_factor     
			,vwprc_comment   = spprc_comment     
			,vwprc_cost_to_use_las = spprc_cost_to_use_las   
			,vwprc_qty_disc_by_pa = spprc_qty_disc_by_pa   
			,vwprc_units_1   = spprc_units_1     
			,vwprc_units_2   = spprc_units_2     
			,vwprc_units_3   = spprc_units_3     
			,vwprc_disc_per_un_1  = spprc_disc_per_un_1    
			,vwprc_disc_per_un_2  = spprc_disc_per_un_2    
			,vwprc_disc_per_un_3  = spprc_disc_per_un_3    
			,vwprc_fet_yn   = spprc_fet_yn     
			,vwprc_set_yn   = spprc_set_yn     
			,vwprc_sst_ynp   = spprc_sst_ynp     
			,vwprc_lc1_yn   = spprc_lc1_yn     
			,vwprc_lc2_yn   = spprc_lc2_yn     
			,vwprc_lc3_yn   = spprc_lc3_yn     
			,vwprc_lc4_yn   = spprc_lc4_yn     
			,vwprc_lc5_yn   = spprc_lc5_yn     
			,vwprc_lc6_yn   = spprc_lc6_yn     
			,vwprc_user_id   = spprc_user_id     
			,vwprc_user_rev_dt  = spprc_user_rev_dt    
			,A4GLIdentity = CAST(A4GLIdentity   AS INT)
			FROM  
			spprcmst
			')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()) = 1
	IF (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PSP' and strDBName = db_name()) = 1
		EXEC ('
			CREATE VIEW [dbo].[vwprcmst]  
			AS  
			SELECT  ''PETRO HERE'' XX
			')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwpyemst')
	DROP VIEW vwpyemst
GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwpyemst]
		AS
		SELECT 
		vwpye_amt	= agpye_amt
		,vwpye_cus_no	=agpye_cus_no
		from
		agpyemst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwpyemst]
		AS
		SELECT 
			vwpye_amt	= ptpye_amt
			,vwpye_cus_no	=ptpye_cus_no
			from
			ptpyemst
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwslsmst')
	DROP VIEW vwslsmst
GO

-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwslsmst]  
		AS  
		SELECT   	  
		vwsls_slsmn_id   = agsls_slsmn_id  
		,vwsls_name    =  ISNULL(agsls_name, '''')
		,vwsls_addr1   = agsls_addr1  
		,vwsls_addr2   = agsls_addr2  
		,vwsls_city    = agsls_city  
		,vwsls_state   = agsls_state  
		,vwsls_zip    = agsls_zip  
		,vwsls_country   = CAST(agsls_country AS CHAR(4))  
		,vwsls_phone   = agsls_phone  
		,vwsls_sales_ty_1  = agsls_sales_ty_1  
		,vwsls_sales_ty_2  = agsls_sales_ty_2  
		,vwsls_sales_ty_3  = agsls_sales_ty_3  
		,vwsls_sales_ty_4  = agsls_sales_ty_4  
		,vwsls_sales_ty_5  = agsls_sales_ty_5  
		,vwsls_sales_ty_6  = agsls_sales_ty_6  
		,vwsls_sales_ty_7  = agsls_sales_ty_7  
		,vwsls_sales_ty_8  = agsls_sales_ty_8  
		,vwsls_sales_ty_9  = agsls_sales_ty_9  
		,vwsls_sales_ty_10  = agsls_sales_ty_10  
		,vwsls_sales_ty_11  = agsls_sales_ty_11  
		,vwsls_sales_ty_12  = agsls_sales_ty_12  
		,vwsls_sales_ly_1  = agsls_sales_ly_1  
		,vwsls_sales_ly_2  = agsls_sales_ly_2  
		,vwsls_sales_ly_3  = agsls_sales_ly_3  
		,vwsls_sales_ly_4  = agsls_sales_ly_4  
		,vwsls_sales_ly_5  = agsls_sales_ly_5  
		,vwsls_sales_ly_6  = agsls_sales_ly_6  
		,vwsls_sales_ly_7  = agsls_sales_ly_7  
		,vwsls_sales_ly_8  = agsls_sales_ly_8  
		,vwsls_sales_ly_9  = agsls_sales_ly_9  
		,vwsls_sales_ly_10  = agsls_sales_ly_10  
		,vwsls_sales_ly_11  = agsls_sales_ly_11  
		,vwsls_sales_ly_12  = agsls_sales_ly_12  
		,vwsls_profit_ty_1  = agsls_profit_ty_1  
		,vwsls_profit_ty_2  = agsls_profit_ty_2  
		,vwsls_profit_ty_3  = agsls_profit_ty_3  
		,vwsls_profit_ty_4  = agsls_profit_ty_4  
		,vwsls_profit_ty_5  = agsls_profit_ty_5  
		,vwsls_profit_ty_6  = agsls_profit_ty_6  
		,vwsls_profit_ty_7  = agsls_profit_ty_7  
		,vwsls_profit_ty_8  = agsls_profit_ty_8  
		,vwsls_profit_ty_9  = agsls_profit_ty_9  
		,vwsls_profit_ty_10  = agsls_profit_ty_10  
		,vwsls_profit_ty_11  = agsls_profit_ty_11  
		,vwsls_profit_ty_12  = agsls_profit_ty_12  
		,vwsls_profit_ly_1  = agsls_profit_ly_1  
		,vwsls_profit_ly_2  = agsls_profit_ly_2  
		,vwsls_profit_ly_3  = agsls_profit_ly_3  
		,vwsls_profit_ly_4  = agsls_profit_ly_4  
		,vwsls_profit_ly_5  = agsls_profit_ly_5  
		,vwsls_profit_ly_6  = agsls_profit_ly_6  
		,vwsls_profit_ly_7  = agsls_profit_ly_7  
		,vwsls_profit_ly_8  = agsls_profit_ly_8  
		,vwsls_profit_ly_9  = agsls_profit_ly_9  
		,vwsls_profit_ly_10  = agsls_profit_ly_10  
		,vwsls_profit_ly_11  = agsls_profit_ly_11  
		,vwsls_profit_ly_12  = agsls_profit_ly_12  
		,vwsls_email   = agsls_email  
		,vwsls_textmsg_email = agsls_textmsg_email  
		,vwsls_dispatch_email = CAST(agsls_dispatch_email AS CHAR(4))  
		,vwsls_user_id   = agsls_user_id  
		,vwsls_user_rev_dt  = agsls_user_rev_dt  
		,A4GLIdentity  = CAST(A4GLIdentity   AS INT)
		FROM agslsmst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwslsmst]  
		AS  
		SELECT  
	  
		vwsls_slsmn_id   = ptsls_slsmn_id  
		,vwsls_name    =  ISNULL(ptsls_name, '''')
		,vwsls_addr1   = ptsls_addr1  
		,vwsls_addr2   = ptsls_addr2  
		,vwsls_city    = ptsls_city  
		,vwsls_state   = ptsls_state  
		,vwsls_zip    = ptsls_zip  
		,vwsls_country   = CAST(NULL AS CHAR(4))
		,vwsls_phone   = CAST(ptsls_phone AS CHAR(15))  
		,vwsls_sales_ty_1  = ptsls_sales_ty_1  
		,vwsls_sales_ty_2  = ptsls_sales_ty_2  
		,vwsls_sales_ty_3  = ptsls_sales_ty_3  
		,vwsls_sales_ty_4  = ptsls_sales_ty_4  
		,vwsls_sales_ty_5  = ptsls_sales_ty_5  
		,vwsls_sales_ty_6  = ptsls_sales_ty_6  
		,vwsls_sales_ty_7  = ptsls_sales_ty_7  
		,vwsls_sales_ty_8  = ptsls_sales_ty_8  
		,vwsls_sales_ty_9  = ptsls_sales_ty_9  
		,vwsls_sales_ty_10  = ptsls_sales_ty_10  
		,vwsls_sales_ty_11  = ptsls_sales_ty_11  
		,vwsls_sales_ty_12  = ptsls_sales_ty_12  
		,vwsls_sales_ly_1  = ptsls_sales_ly_1  
		,vwsls_sales_ly_2  = ptsls_sales_ly_2  
		,vwsls_sales_ly_3  = ptsls_sales_ly_3  
		,vwsls_sales_ly_4  = ptsls_sales_ly_4  
		,vwsls_sales_ly_5  = ptsls_sales_ly_5  
		,vwsls_sales_ly_6  = ptsls_sales_ly_6  
		,vwsls_sales_ly_7  = ptsls_sales_ly_7  
		,vwsls_sales_ly_8  = ptsls_sales_ly_8  
		,vwsls_sales_ly_9  = ptsls_sales_ly_9  
		,vwsls_sales_ly_10  = ptsls_sales_ly_10  
		,vwsls_sales_ly_11  = ptsls_sales_ly_11  
		,vwsls_sales_ly_12  = ptsls_sales_ly_12  
		,vwsls_profit_ty_1  = ptsls_profit_ty_1  
		,vwsls_profit_ty_2  = ptsls_profit_ty_2  
		,vwsls_profit_ty_3  = ptsls_profit_ty_3  
		,vwsls_profit_ty_4  = ptsls_profit_ty_4  
		,vwsls_profit_ty_5  = ptsls_profit_ty_5  
		,vwsls_profit_ty_6  = ptsls_profit_ty_6  
		,vwsls_profit_ty_7  = ptsls_profit_ty_7  
		,vwsls_profit_ty_8  = ptsls_profit_ty_8  
		,vwsls_profit_ty_9  = ptsls_profit_ty_9  
		,vwsls_profit_ty_10  = ptsls_profit_ty_10  
		,vwsls_profit_ty_11  = ptsls_profit_ty_11  
		,vwsls_profit_ty_12  = ptsls_profit_ty_12  
		,vwsls_profit_ly_1  = ptsls_profit_ly_1  
		,vwsls_profit_ly_2  = ptsls_profit_ly_2  
		,vwsls_profit_ly_3  = ptsls_profit_ly_3  
		,vwsls_profit_ly_4  = ptsls_profit_ly_4  
		,vwsls_profit_ly_5  = ptsls_profit_ly_5  
		,vwsls_profit_ly_6  = ptsls_profit_ly_6  
		,vwsls_profit_ly_7  = ptsls_profit_ly_7  
		,vwsls_profit_ly_8  = ptsls_profit_ly_8  
		,vwsls_profit_ly_9  = ptsls_profit_ly_9  
		,vwsls_profit_ly_10  = ptsls_profit_ly_10  
		,vwsls_profit_ly_11  = ptsls_profit_ly_11  
		,vwsls_profit_ly_12  = ptsls_profit_ly_12  
		,vwsls_email   = CAST(ptsls_email AS CHAR(50))  
		,vwsls_textmsg_email = CAST(ptsls_textmsg_email AS CHAR(50))  
		,vwsls_dispatch_email = CAST(ptsls_dispatch_email AS CHAR(4))  
		,vwsls_user_id   = CAST(NULL AS CHAR(16))  
		,vwsls_user_rev_dt  = NULL  
		,A4GLIdentity  = CAST(A4GLIdentity   AS INT)
		FROM ptslsmst
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwtaxmst')
	DROP VIEW vwtaxmst
GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwtaxmst]  
		AS  
		SELECT  
		  
		 vwtax_itm_no   = agtax_itm_no  
		, vwtax_state    = agtax_state  
		, vwtax_auth_id1   = agtax_auth_id1  
		, vwtax_auth_id2   = agtax_auth_id2  
		, vwtax_if_rt    = agtax_if_rt  
		, vwtax_if_gl_acct  = agtax_if_gl_acct  
		, vwtax_fet_rt   = CAST(agtax_fet_rt AS DECIMAL(18,6))  
		, vwtax_fet_sls_acct  = agtax_fet_sls_acct  
		, vwtax_fet_pur_acct  = agtax_fet_pur_acct  
		, vwtax_fet_eft_yn  = CAST(agtax_fet_eft_yn AS CHAR(4))  
		, vwtax_set_rt   = agtax_set_rt  
		, vwtax_set_sls_acct  = agtax_set_sls_acct  
		, vwtax_set_pur_acct  = agtax_set_pur_acct  
		, vwtax_set_eft_yn  = CAST(agtax_set_eft_yn AS CHAR(4))  
		, vwtax_sst_rt   = agtax_sst_rt  
		, vwtax_sst_sls_acct  = agtax_sst_sls_acct  
		, vwtax_sst_pur_acct  = agtax_sst_pur_acct  
		, vwtax_sst_pu   = agtax_sst_pu  
		, vwtax_sst_on_fet_yn  = CAST(agtax_sst_on_fet_yn AS CHAR(4))  
		, vwtax_sst_on_set_yn  = agtax_sst_on_set_yn  
		, vwtax_sst_eft_yn  = CAST(agtax_sst_eft_yn AS CHAR(4))  
		, vwtax_pst_rt   = agtax_pst_rt  
		, vwtax_pst_sls_acct  = agtax_pst_sls_acct  
		, vwtax_pst_pur_acct  = agtax_pst_pur_acct  
		, vwtax_pst_pu   = CAST(agtax_pst_pu AS CHAR(4))  
		, vwtax_pst_on_fet_yn  = CAST(agtax_pst_on_fet_yn AS CHAR(4))  
		, vwtax_pst_on_set_yn  = CAST(agtax_pst_on_set_yn AS CHAR(4))  
		, vwtax_lc1_rt   = agtax_lc1_rt  
		, vwtax_lc1_sls_acct  = agtax_lc1_sls_acct  
		, vwtax_lc1_pur_acct  = agtax_lc1_pur_acct  
		, vwtax_lc1_pu   = CAST(agtax_lc1_pu AS CHAR(4))  
		, vwtax_sst_on_lc1_yn  = CAST(agtax_sst_on_lc1_yn AS CHAR(4))  
		, vwtax_lc1_on_fet_yn  = CAST(agtax_lc1_on_fet_yn AS CHAR(4))  
		, vwtax_lc1_eft_yn  = agtax_lc1_eft_yn  
		, vwtax_lc1_scrn_desc  = CAST(agtax_lc1_scrn_desc AS CHAR(4))  
		, vwtax_lc2_rt   = agtax_lc2_rt  
		, vwtax_lc2_sls_acct  = agtax_lc2_sls_acct  
		, vwtax_lc2_pur_acct  = agtax_lc2_pur_acct  
		, vwtax_lc2_pu   = CAST(agtax_lc2_pu AS CHAR(4))  
		, vwtax_sst_on_lc2_yn  = CAST(agtax_sst_on_lc2_yn AS CHAR(4))  
		, vwtax_lc2_on_fet_yn  = CAST(agtax_lc2_on_fet_yn AS CHAR(4))  
		, vwtax_lc2_eft_yn  = agtax_lc2_eft_yn  
		, vwtax_lc2_scrn_desc  = CAST(agtax_lc2_scrn_desc AS CHAR(4))  
		, vwtax_lc3_rt   = agtax_lc3_rt  
		, vwtax_lc3_sls_acct  = agtax_lc3_sls_acct  
		, vwtax_lc3_pur_acct  = agtax_lc3_pur_acct  
		, vwtax_lc3_pu   = CAST(agtax_lc3_pu AS CHAR(4))  
		, vwtax_sst_on_lc3_yn  = CAST(agtax_sst_on_lc3_yn AS CHAR(4))  
		, vwtax_lc3_on_fet_yn  = CAST(agtax_lc3_on_fet_yn AS CHAR(4))  
		, vwtax_lc3_eft_yn  = CAST(agtax_lc3_eft_yn AS CHAR(4))  
		, vwtax_lc3_scrn_desc  = CAST(agtax_lc3_scrn_desc AS CHAR(4))  
		, vwtax_lc4_rt   = agtax_lc4_rt  
		, vwtax_lc4_sls_acct  = agtax_lc4_sls_acct  
		, vwtax_lc4_pur_acct  = agtax_lc4_pur_acct  
		, vwtax_lc4_pu   = CAST(agtax_lc4_pu AS CHAR(4))  
		, vwtax_sst_on_lc4_yn  = CAST(agtax_sst_on_lc4_yn AS CHAR(4))  
		, vwtax_lc4_on_fet_yn  = CAST(agtax_lc4_on_fet_yn AS CHAR(4))  
		, vwtax_lc4_eft_yn  = agtax_lc4_eft_yn  
		, vwtax_lc4_scrn_desc  = CAST(agtax_lc4_scrn_desc AS CHAR(4))  
		, vwtax_lc5_rt   = agtax_lc5_rt  
		, vwtax_lc5_sls_acct  = agtax_lc5_sls_acct  
		, vwtax_lc5_pur_acct  = agtax_lc5_pur_acct  
		, vwtax_lc5_pu   = CAST(agtax_lc5_pu AS CHAR(4))  
		, vwtax_sst_on_lc5_yn  = CAST(agtax_sst_on_lc5_yn AS CHAR(4))  
		, vwtax_lc5_on_fet_yn  = CAST(agtax_lc5_on_fet_yn AS CHAR(4))  
		, vwtax_lc5_eft_yn  = agtax_lc5_eft_yn  
		, vwtax_lc5_scrn_desc  = CAST(agtax_lc5_scrn_desc AS CHAR(4))  
		, vwtax_lc6_rt   = agtax_lc6_rt  
		, vwtax_lc6_sls_acct  = agtax_lc6_sls_acct  
		, vwtax_lc6_pur_acct  = agtax_lc6_pur_acct  
		, vwtax_lc6_pu   = CAST(agtax_lc6_pu AS CHAR(4))  
		, vwtax_sst_on_lc6_yn  = CAST(agtax_sst_on_lc6_yn AS CHAR(4))  
		, vwtax_lc6_on_fet_yn  = CAST(agtax_lc6_on_fet_yn AS CHAR(4))  
		, vwtax_lc6_eft_yn  = agtax_lc6_eft_yn  
		, vwtax_lc6_scrn_desc  = CAST(agtax_lc6_scrn_desc AS CHAR(4))  
		, vwtax_user_id   = agtax_user_id  
		, vwtax_user_rev_dt  = agtax_user_rev_dt  
		, A4GLIdentity   = CAST(A4GLIdentity   AS INT)
		FROM [agtaxmst]
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwtaxmst]  
		AS  
			SELECT  
	  
		 vwtax_itm_no   = CAST(pttax_itm_no AS CHAR(13))  
		, vwtax_state    = pttax_state  
		, vwtax_auth_id1   = pttax_local1  
		, vwtax_auth_id2   = pttax_local2  
		, vwtax_if_rt    = pttax_fet_rt  
		, vwtax_if_gl_acct  = pttax_fet_acct  
		, vwtax_fet_rt   = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_fet_sls_acct  = CAST(0.00 AS DECIMAL(18,6))
		, vwtax_fet_pur_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_fet_eft_yn  = CAST(NULL AS CHAR(4))  
		, vwtax_set_rt   = pttax_set_rt
		, vwtax_set_sls_acct  = pttax_set_acct  
		, vwtax_set_pur_acct  = CAST(0.00 AS DECIMAL(18,6))
		, vwtax_set_eft_yn  = CAST(NULL AS CHAR(4))
		, vwtax_sst_rt   = pttax_sst_rt  
		, vwtax_sst_sls_acct  = CAST(pttax_sst_on_fet_yn AS DECIMAL(18,6))  
		, vwtax_sst_pur_acct  = CAST(pttax_sst_on_set_yn AS DECIMAL(18,6))  
		, vwtax_sst_pu   = pttax_sst_pu  
		, vwtax_sst_on_fet_yn  = CAST(NULL AS CHAR(4))
		, vwtax_sst_on_set_yn  = pttax_pst_pu 
		, vwtax_sst_eft_yn  = CAST(NULL AS CHAR(4))
		, vwtax_pst_rt   = pttax_pst_rt  
		, vwtax_pst_sls_acct  = CAST(0.00 AS DECIMAL(18,6))
		, vwtax_pst_pur_acct  = CAST(0.00 AS DECIMAL(18,6))
		, vwtax_pst_pu   = CAST(NULL AS CHAR(4))  
		, vwtax_pst_on_fet_yn  = CAST(NULL AS CHAR(4))  
		, vwtax_pst_on_set_yn  = CAST(NULL AS CHAR(4))  
		, vwtax_lc1_rt   = pttax_lc1_rt  
		, vwtax_lc1_sls_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc1_pur_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc1_pu   = CAST(NULL AS CHAR(4))  
		, vwtax_sst_on_lc1_yn  = CAST(NULL AS CHAR(4))  
		, vwtax_lc1_on_fet_yn  = CAST(NULL AS CHAR(4))
		, vwtax_lc1_eft_yn  = pttax_lc1_eft_yn  
		, vwtax_lc1_scrn_desc  = CAST(NULL AS CHAR(4))
		, vwtax_lc2_rt   = pttax_lc2_rt  
		, vwtax_lc2_sls_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc2_pur_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc2_pu   = CAST(NULL AS CHAR(4))
		, vwtax_sst_on_lc2_yn  = CAST(NULL AS CHAR(4))  
		, vwtax_lc2_on_fet_yn  = CAST(NULL AS CHAR(4)) 
		, vwtax_lc2_eft_yn  = pttax_lc2_eft_yn  
		, vwtax_lc2_scrn_desc  = CAST(NULL AS CHAR(4)) 
		, vwtax_lc3_rt   = pttax_lc3_rt  
		, vwtax_lc3_sls_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc3_pur_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc3_pu   = CAST(NULL AS CHAR(4))  
		, vwtax_sst_on_lc3_yn  = CAST(NULL AS CHAR(4))  
		, vwtax_lc3_on_fet_yn  = CAST(NULL AS CHAR(4)) 
		, vwtax_lc3_eft_yn  = CAST(pttax_lc3_eft_yn AS CHAR(4)) 
		, vwtax_lc3_scrn_desc  = CAST(NULL AS CHAR(4))  
		, vwtax_lc4_rt   = pttax_lc4_rt  
		, vwtax_lc4_sls_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc4_pur_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc4_pu   = CAST(NULL AS CHAR(4))  
		, vwtax_sst_on_lc4_yn  = CAST(NULL AS CHAR(4)) 
		, vwtax_lc4_on_fet_yn  = CAST(NULL AS CHAR(4))
		, vwtax_lc4_eft_yn  = pttax_lc4_eft_yn  
		, vwtax_lc4_scrn_desc  = CAST(NULL AS CHAR(4)) 
		, vwtax_lc5_rt   = pttax_lc5_rt  
		, vwtax_lc5_sls_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc5_pur_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc5_pu   = CAST(NULL AS CHAR(4))
		, vwtax_sst_on_lc5_yn  = CAST(NULL AS CHAR(4))
		, vwtax_lc5_on_fet_yn  = CAST(NULL AS CHAR(4))
		, vwtax_lc5_eft_yn  = pttax_lc5_eft_yn  
		, vwtax_lc5_scrn_desc  = CAST(NULL AS CHAR(4))  
		, vwtax_lc6_rt   = pttax_lc6_rt 
		, vwtax_lc6_sls_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc6_pur_acct  = CAST(0.00 AS DECIMAL(18,6))  
		, vwtax_lc6_pu   = CAST(NULL AS CHAR(4)) 
		, vwtax_sst_on_lc6_yn  = CAST(NULL AS CHAR(4))
		, vwtax_lc6_on_fet_yn  = CAST(NULL AS CHAR(4))
		, vwtax_lc6_eft_yn  = pttax_lc6_eft_yn  
		, vwtax_lc6_scrn_desc  = CAST(NULL AS CHAR(4))
		, vwtax_user_id   = CAST(NULL AS CHAR(16))
		, vwtax_user_rev_dt  = NULL  
		, A4GLIdentity   = CAST(A4GLIdentity   AS INT)
		FROM [pttaxmst]
		')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwticmst')
	DROP VIEW vwticmst
GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwticmst]
		AS
		SELECT
		vwtic_ship_total	= CAST(0 AS DECIMAL(18,6))
		,vwtic_cus_no	= CAST('' AS CHAR(10))
		,vwtic_type	= CAST('' AS CHAR(1))
	')
GO

-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwticmst]
		AS
		SELECT
		vwtic_ship_total	= pttic_ship_total
		,vwtic_cus_no	= pttic_cus_no
		,vwtic_type	= pttic_type
		FROM
		ptticmst
			')
GO

IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwtrmmst')
	DROP VIEW vwtrmmst
GO
-- AG VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'AG' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwtrmmst]
		AS
		SELECT 
		vwtrm_key_n = CAST(agtrm_key_n AS INT)
		,vwtrm_desc = agtrm_desc
		,A4GLIdentity= CAsT(A4GLIdentity AS INT)
		FROM
		agtrmmst
		')
GO
-- PT VIEW
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'PT' and strDBName = db_name()	) = 1
	EXEC ('
		CREATE VIEW [dbo].[vwtrmmst]
		AS
		SELECT 
		vwtrm_key_n = CAST(pttrm_code AS INT)
		,vwtrm_desc = pttrm_desc
		,A4GLIdentity= CAsT(A4GLIdentity AS INT)
		FROM
		pttrmmst

		')
GO


IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vwDispatch')
	DROP VIEW vwDispatch
GO

CREATE VIEW [dbo].[vwDispatch]
	AS
	SELECT
	DispatchID = A.intDispatchID,
	CustomerNumber = H.vwcus_key + ' ' + CASE H.vwcus_co_per_ind_cp
			WHEN 'C' THEN RTRIM(H.vwcus_last_name) + H.vwcus_first_name
			ELSE RTRIM(H.vwcus_last_name) + ',' + H.vwcus_first_name
			END,
	CustomerName = 
			CASE H.vwcus_co_per_ind_cp
			WHEN 'C' THEN RTRIM(H.vwcus_last_name) + H.vwcus_first_name
			ELSE RTRIM(H.vwcus_last_name) + ',' + H.vwcus_first_name
			END,
	SiteNumber = RIGHT(CAST('0000' + CAST(B.intSiteNumber as varchar) as varchar), 4)+' '+LTRIM(B.strSiteAddress),--B.intSiteNumber,
	SiteAddress = B.strSiteAddress,
	SiteDescription = B.strDescription,
	SiteLocation = B.strLocation,
	SiteID = B.intSiteID,
	RunOutDate = B.dtmRunOutDate,
	ProductNo = F.vwitm_no,
	ProductDesc = RTRIM(F.vwitm_desc),
	ProductID = F.A4GLIdentity,
	ClockNo = D.strClockNumber,
	DispatchRequestedDate = A.dtmRequestedDate,
	DispatchDate = A.dtmCallInDate,
	MinimumQuantity = A.dblMinimumQuantity,
	Price = A.dblPrice,
	Total = A.dblTotal,
	DriverName = RTRIM(G.vwsls_name),
	DriverID = G.vwsls_slsmn_id,
	NextDeliveryDegreeDay = B.intNextDeliveryDegreeDay,
	isDispatched = A.ysnDispatched,
	RouteName = E.strRouteID,
	RouteID = E.intRouteID
	FROM tblTMDispatch A
	INNER JOIN tblTMSite B ON A.intSiteID = B.intSiteID
	INNER JOIN tblTMCustomer C ON B.intCustomerID = C.intCustomerID
	INNER JOIN tblTMClock D ON D.intClockID = B.intClockID
	INNER JOIN tblTMRoute E ON B.intRouteID = E.intRouteID
	INNER JOIN vwitmmst F ON CAST(F.A4GLIdentity AS INT) = B.intProduct 
	INNER JOIN vwslsmst G ON CAST(G.A4GLIdentity AS INT) = A.intDriverID
	INNER JOIN vwcusmst H ON H.A4GLIdentity = C.intCustomerNumber
	WHERE B.ysnActive  = 1
		AND H.vwcus_active_yn = 'Y'
GO


-- TAX FORMS

--DELETE OLD VIEW IF EXISTS
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vyuTFTaxCycle')
	DROP VIEW vwpxcycmst
GO
IF EXISTS(select top 1 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME = 'vyuTFTaxCycle')
	DROP VIEW vyuTFTaxCycle

GO
IF  (SELECT TOP 1 ysnUsed FROM ##tblOriginMod WHERE strPrefix = 'TF') = 1
	EXEC ('
		CREATE VIEW [dbo].[vyuTFTaxCycle]
		AS
		SELECT  pxcyc_cycle_id AS vwpxcyc_cycle_id
				, CAST(pxcyc_seq_no as INT) AS vwpxcyc_seq_no
				, pxcyc_rpt_state AS vwpxcyc_rpt_state
				, pxcyc_rpt_form AS vwpxcyc_rpt_form
				, pxcyc_rpt_sched AS vwpxcyc_rpt_sched
				, CAST(pxcyc_number_copies as INT)AS vwpxcyc_number_copies
				, pxcyc_user_id AS vwpxcyc_user_id
				, pxcyc_user_rev_dt AS vwpxcyc_user_rev_dt
				, pxsel_rpt_sched_name as vwpxsel_rpt_sched_name
				, CAST(A.A4GLIdentity as INT) AS vwA4GLIdentity
		FROM dbo.pxcycmst A 
		INNER JOIN pxselmst B ON A.pxcyc_rpt_state = B.pxsel_rpt_state 
		AND A.pxcyc_rpt_sched = B.pxsel_rpt_sched 
		AND A.pxcyc_rpt_form = B.pxsel_rpt_form where pxcyc_number_copies <> 0
	')


GO

GO
/*
Post-Deployment Script Template							
--------------------------------------------------------------------------------------
 This file contains SQL statements that will be appended to the build script.		
 Use SQLCMD syntax to include a file in the post-deployment script.			
 Example:      :r .\myfile.sql								
 Use SQLCMD syntax to reference a variable in the post-deployment script.		
 Example:      :setvar TableName MyTable							
               SELECT * FROM [$(TableName)]					
--------------------------------------------------------------------------------------
*/


-- DROP temp table created from PreDeployment script
IF OBJECT_ID('tempdb..##tblOriginMod') IS NOT NULL DROP TABLE ##tblOriginMod

GO

GO
PRINT N'Update complete.';


GO
