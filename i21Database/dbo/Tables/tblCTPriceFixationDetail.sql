CREATE TABLE [dbo].[tblCTPriceFixationDetail]
(
	[intPriceFixationDetailId]		INT IDENTITY NOT NULL,	
	[intPriceFixationId]			INT NOT NULL,
	[intNumber]						INT NULL,
	[strTradeNo]					NVARCHAR(20) COLLATE Latin1_General_CI_AS NOT NULL ,
	[strOrder]						NVARCHAR(20) COLLATE Latin1_General_CI_AS NOT NULL ,
	[dtmFixationDate]				DATETIME NOT NULL,
	[dblQuantity]					NUMERIC(18,6) NULL,
	[dblQuantityAppliedAndPriced]	NUMERIC(18,6) NULL,
	[dblLoadAppliedAndPriced]		NUMERIC(18,6) NULL,
	[dblLoadPriced]					NUMERIC(18,6) NULL,
	[intQtyItemUOMId]				INT NULL,
	[dblNoOfLots]					NUMERIC(18,6) NOT NULL,
	[intFutureMarketId]				INT NOT NULL,
	[intFutureMonthId]				INT NOT NULL,
	[dblFixationPrice]				NUMERIC(18,6) NULL,
	[dblFutures]					NUMERIC(18,6) NULL,
	[dblBasis]						NUMERIC(18,6) NULL,
	[dblPolRefPrice]				NUMERIC(18,6) NULL,
	[dblPolPremium]					NUMERIC(18,6) NULL,
	[dblCashPrice]					NUMERIC(18,6) NULL,
	[intPricingUOMId]				INT NOT NULL,
	[ysnHedge]						BIT,
	[ysnAA]							BIT,
	[dblHedgePrice]					NUMERIC(18,6) NULL,
	[intHedgeFutureMonthId]			INT,
	[intBrokerId]					INT,
	[intBrokerageAccountId]			INT,
	[intFutOptTransactionId]		INT,
	[dblFinalPrice]					NUMERIC(18,6) NULL,
	[strNotes]						NVARCHAR(100) COLLATE Latin1_General_CI_AS NULL ,
	[intPriceFixationDetailRefId]	INT,
	[intBillId]						INT,
	intBillDetailId					INT,
	intInvoiceId					INT,
	intInvoiceDetailId				INT,
	intDailyAveragePriceDetailId	INT,
	[dblHedgeNoOfLots]				NUMERIC(18,6) NULL,
	--This is to track the used pricing for load
	[dblLoadApplied]				NUMERIC(18,6) NULL,
	[ysnToBeDeleted]				BIT NOT NULL DEFAULT 0,
	[intConcurrencyId]				INT NOT NULL,

	CONSTRAINT [PK_tblCTPriceFixationDetail_intPriceFixationDetailId] PRIMARY KEY CLUSTERED ([intPriceFixationDetailId] ASC),
	CONSTRAINT [UK_tblCTPackingDescriptionDetail_strTradeNo] UNIQUE ([strTradeNo]),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblCTPriceFixation_intPriceFixationId] FOREIGN KEY ([intPriceFixationId]) REFERENCES [tblCTPriceFixation]([intPriceFixationId]) ON DELETE CASCADE,
	
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblICItemUOM_intQtyItemUOMId_intItemUOMId] FOREIGN KEY ([intQtyItemUOMId]) REFERENCES [tblICItemUOM]([intItemUOMId]),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblICCommodityUnitMeasure_intPricingUOMId_intCommodityUnitMeasureId] FOREIGN KEY ([intPricingUOMId]) REFERENCES [tblICCommodityUnitMeasure]([intCommodityUnitMeasureId]),
	
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblRKFutureMarket_intFutureMarketId] FOREIGN KEY ([intFutureMarketId]) REFERENCES [tblRKFutureMarket]([intFutureMarketId]),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblRKFuturesMonth_intFutureMonthId] FOREIGN KEY ([intFutureMonthId]) REFERENCES [tblRKFuturesMonth]([intFutureMonthId]),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblRKFuturesMonth_intHedgeFutureMonthId_intFutureMonthId] FOREIGN KEY ([intHedgeFutureMonthId]) REFERENCES [tblRKFuturesMonth]([intFutureMonthId]),

	CONSTRAINT [FK_tblCTPriceFixationDetail_tblEMEntity_intBrokerId_intEntityId] FOREIGN KEY ([intBrokerId]) REFERENCES tblEMEntity([intEntityId]),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblRKBrokerageAccount_intBrokerageAccountId] FOREIGN KEY ([intBrokerageAccountId]) REFERENCES [tblRKBrokerageAccount]([intBrokerageAccountId]),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblRKFutOptTransaction_intFutOptTransactionId] FOREIGN KEY ([intFutOptTransactionId]) REFERENCES [tblRKFutOptTransaction]([intFutOptTransactionId]),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblAPBill_intBillId] FOREIGN KEY (intBillId) REFERENCES tblAPBill(intBillId),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblAPBillDetail_intBillDetailId] FOREIGN KEY (intBillDetailId) REFERENCES tblAPBillDetail(intBillDetailId),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblARInvoice_intInvoiceId] FOREIGN KEY (intInvoiceId) REFERENCES tblARInvoice(intInvoiceId),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblARInvoiceDetail_intInvoiceDetailId] FOREIGN KEY (intInvoiceDetailId) REFERENCES tblARInvoiceDetail(intInvoiceDetailId),
	CONSTRAINT [FK_tblCTPriceFixationDetail_tblRKDailyAveragePriceDetail_intDailyAveragePriceDetailId] FOREIGN KEY (intDailyAveragePriceDetailId) REFERENCES tblRKDailyAveragePriceDetail(intDailyAveragePriceDetailId)
)
GO
CREATE NONCLUSTERED INDEX [IX_tblCTPriceFixationDetail_intPriceFixationId] ON [dbo].[tblCTPriceFixationDetail](intPriceFixationId);
GO
