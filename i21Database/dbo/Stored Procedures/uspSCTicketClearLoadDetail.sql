CREATE PROCEDURE [dbo].[uspSCTicketClearLoadDetail]
	@TICKET_ID INT
	,@USER_ID INT
AS
	
	DECLARE @DISTRIBUTION_OPTION NVARCHAR(50)
	DECLARE @LOAD_ID INT 


	SELECT
		
		@DISTRIBUTION_OPTION = strDistributionOption
		,@LOAD_ID = intLoadId

	FROM tblSCTicket
	WHERE intTicketId = @TICKET_ID



	IF @DISTRIBUTION_OPTION = 'LRF'
	BEGIN

		DECLARE @TEMP_LOAD_DETAIL_ID TABLE( ID INT)
		DECLARE @CURRENT_LOAD_DETAIL_ID INT

		INSERT INTO @TEMP_LOAD_DETAIL_ID (ID)
		SELECT intLoadDetailId
		FROM tblLGLoadDetail
		WHERE intLoadId = @LOAD_ID

		SELECT @CURRENT_LOAD_DETAIL_ID = MIN(ID) FROM @TEMP_LOAD_DETAIL_ID

		WHILE @CURRENT_LOAD_DETAIL_ID IS NOT NULL
		BEGIN
			
			EXEC uspLGDeleteLoadDetail @intLoadDetailId = @CURRENT_LOAD_DETAIL_ID, @intEntityUserId = @USER_ID


			DELETE FROM @TEMP_LOAD_DETAIL_ID WHERE ID = @CURRENT_LOAD_DETAIL_ID
			SELECT @CURRENT_LOAD_DETAIL_ID = MIN(ID) FROM @TEMP_LOAD_DETAIL_ID
		END



	END

GO



